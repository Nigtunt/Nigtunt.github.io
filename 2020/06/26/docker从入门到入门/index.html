<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><title>docker从入门到入门 | Nigtunt</title><meta name="description" content="docker从入门到入门"><meta name="keywords" content="docker"><meta name="author" content="Nigtunt"><meta name="copyright" content="Nigtunt"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="/img/favicon.ico"><link rel="preconnect" href="//cdn.jsdelivr.net"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:title" content="docker从入门到入门"><meta name="twitter:description" content="docker从入门到入门"><meta name="twitter:image" content="https://timgsa.baidu.com/timg?image&amp;quality=80&amp;size=b9999_10000&amp;sec=1593166873350&amp;di=8ec88b6a272f42e99b088baa56395b63&amp;imgtype=0&amp;src=http%3A%2F%2Fimg4.imgtn.bdimg.com%2Fit%2Fu%3D3899586244%2C3729560110%26fm%3D214%26gp%3D0.jpg"><meta property="og:type" content="article"><meta property="og:title" content="docker从入门到入门"><meta property="og:url" content="https://nigtunt.github.io/2020/06/26/docker%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E5%85%A5%E9%97%A8/"><meta property="og:site_name" content="Nigtunt"><meta property="og:description" content="docker从入门到入门"><meta property="og:image" content="https://timgsa.baidu.com/timg?image&amp;quality=80&amp;size=b9999_10000&amp;sec=1593166873350&amp;di=8ec88b6a272f42e99b088baa56395b63&amp;imgtype=0&amp;src=http%3A%2F%2Fimg4.imgtn.bdimg.com%2Fit%2Fu%3D3899586244%2C3729560110%26fm%3D214%26gp%3D0.jpg"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><script src="https://cdn.jsdelivr.net/npm/js-cookie/dist/js.cookie.min.js"></script><script>const autoChangeMode = 'false'
var t = Cookies.get("theme");
if (autoChangeMode == '1'){
const isDarkMode = window.matchMedia("(prefers-color-scheme: dark)").matches
const isLightMode = window.matchMedia("(prefers-color-scheme: light)").matches
const isNotSpecified = window.matchMedia("(prefers-color-scheme: no-preference)").matches
const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

if (t === undefined){
  if (isLightMode) activateLightMode()
  else if (isDarkMode) activateDarkMode()
  else if (isNotSpecified || hasNoSupport){
    console.log('You specified no preference for a color scheme or your browser does not support it. I Schedule dark mode during night time.')
    now = new Date();
    hour = now.getHours();
    isNight = hour < 6 || hour >= 18
    isNight ? activateDarkMode() : activateLightMode()
}
} else if (t == 'light') activateLightMode()
else activateDarkMode()


} else if (autoChangeMode == '2'){
  now = new Date();
  hour = now.getHours();
  isNight = hour < 6 || hour >= 18
  if(t === undefined) isNight? activateDarkMode() : activateLightMode()
  else if (t === 'light') activateLightMode()
  else activateDarkMode() 
} else {
  if ( t == 'dark' ) activateDarkMode()
  else if ( t == 'light') activateLightMode()
}

function activateDarkMode(){
  document.documentElement.setAttribute('data-theme', 'dark')
  if (document.querySelector('meta[name="theme-color"]') !== null){
    document.querySelector('meta[name="theme-color"]').setAttribute('content','#000')
  }
}
function activateLightMode(){
  document.documentElement.setAttribute('data-theme', 'light')
  if (document.querySelector('meta[name="theme-color"]') !== null){
  document.querySelector('meta[name="theme-color"]').setAttribute('content','#fff')
  }
}</script><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><link rel="canonical" href="https://nigtunt.github.io/2020/06/26/docker%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E5%85%A5%E9%97%A8/"><link rel="prev" title="MybatisPlus使用简介" href="https://nigtunt.github.io/2020/06/26/MybatisPlus%E4%BD%BF%E7%94%A8%E7%AE%80%E4%BB%8B/"><link rel="next" title="使用redis存在的问题" href="https://nigtunt.github.io/2020/06/26/%E4%BD%BF%E7%94%A8redis%E5%AD%98%E5%9C%A8%E7%9A%84%E9%97%AE%E9%A2%98/"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容:${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"cookieDomain":"https://xxx/","msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简"},
  highlight_copy: 'true',
  highlight_lang: 'true',
  highlight_shrink: 'false',
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  bookmark: {
    title: 'Snackbar.bookmark.title',
    message_prev: '按',
    message_next: '键将本页加入书签'
  },
  runtime_unit: '天',
  copyright: undefined,
  copy_copyright_js: false,
  ClickShowText: undefined,
  medium_zoom: 'false',
  Snackbar: undefined
  
}</script><meta name="generator" content="Hexo 4.2.1"></head><body><canvas class="fireworks"></canvas><div id="header"> <div id="page-header"><span class="pull_left" id="blog_name"><a class="blog_title" id="site-name" href="/">Nigtunt</a></span><i class="fa fa-bars fa-fw toggle-menu pull_right close" aria-hidden="true"></i><span class="pull_right menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于</span></a></div></div></span><span class="pull_right" id="search_button"><a class="site-page social-icon search"><i class="fa fa-search fa-fw"></i><span> 搜索</span></a></span></div></div><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="lazyload avatar_img" src="https://yhaq.top/group1/M00/00/00/head.png" onerror="onerror=null;src='/img/friend_404.gif'"></div><div class="mobile_post_data"><div class="mobile_data_item is_center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">文章</div><div class="length_num">132</div></a></div></div><div class="mobile_data_item is_center">      <div class="mobile_data_link"><a href="/tags/"><div class="headline">标签</div><div class="length_num">37</div></a></div></div><div class="mobile_data_item is_center">     <div class="mobile_data_link"><a href="/categories/"><div class="headline">分类</div><div class="length_num">15</div></a></div></div></div><hr><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于</span></a></div></div></div><div id="mobile-sidebar-toc"><div class="toc_mobile_headline">目录</div><ol class="toc_mobile_items"><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#docker安装"><span class="toc_mobile_items-number">1.</span> <span class="toc_mobile_items-text">docker安装</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#配置阿里云镜像加速"><span class="toc_mobile_items-number">1.1.</span> <span class="toc_mobile_items-text">配置阿里云镜像加速</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#底层原理"><span class="toc_mobile_items-number">1.2.</span> <span class="toc_mobile_items-text">底层原理</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#docker的常用命令"><span class="toc_mobile_items-number">2.</span> <span class="toc_mobile_items-text">docker的常用命令</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#帮助命令"><span class="toc_mobile_items-number">2.1.</span> <span class="toc_mobile_items-text">帮助命令</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#镜像命令"><span class="toc_mobile_items-number">2.2.</span> <span class="toc_mobile_items-text">镜像命令</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#容器命令"><span class="toc_mobile_items-number">2.3.</span> <span class="toc_mobile_items-text">容器命令</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#其他常用命令"><span class="toc_mobile_items-number">2.4.</span> <span class="toc_mobile_items-text">其他常用命令</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#小结"><span class="toc_mobile_items-number">2.5.</span> <span class="toc_mobile_items-text">小结</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#练习"><span class="toc_mobile_items-number">2.6.</span> <span class="toc_mobile_items-text">练习</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#"><span class="toc_mobile_items-number">3.</span> <span class="toc_mobile_items-text">Welcome to nginx!</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#可视化"><span class="toc_mobile_items-number">3.1.</span> <span class="toc_mobile_items-text">可视化</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#docker镜像讲解"><span class="toc_mobile_items-number">4.</span> <span class="toc_mobile_items-text">docker镜像讲解</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#镜像是什么"><span class="toc_mobile_items-number">4.1.</span> <span class="toc_mobile_items-text">镜像是什么</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#docker镜像加载原理"><span class="toc_mobile_items-number">4.2.</span> <span class="toc_mobile_items-text">docker镜像加载原理</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#分层理解"><span class="toc_mobile_items-number">4.3.</span> <span class="toc_mobile_items-text">分层理解</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#commit镜像"><span class="toc_mobile_items-number">4.4.</span> <span class="toc_mobile_items-text">commit镜像</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#容器数据卷"><span class="toc_mobile_items-number">5.</span> <span class="toc_mobile_items-text">容器数据卷</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#什么是容器数据卷"><span class="toc_mobile_items-number">5.1.</span> <span class="toc_mobile_items-text">什么是容器数据卷</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#使用数据卷"><span class="toc_mobile_items-number">5.2.</span> <span class="toc_mobile_items-text">使用数据卷</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#mysql安装以及数据同步"><span class="toc_mobile_items-number">5.3.</span> <span class="toc_mobile_items-text">mysql安装以及数据同步</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#具名挂载和匿名挂载"><span class="toc_mobile_items-number">5.4.</span> <span class="toc_mobile_items-text">具名挂载和匿名挂载</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#初识DockerFile"><span class="toc_mobile_items-number">5.5.</span> <span class="toc_mobile_items-text">初识DockerFile</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#数据卷容器"><span class="toc_mobile_items-number">5.6.</span> <span class="toc_mobile_items-text">数据卷容器</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#DockerFile"><span class="toc_mobile_items-number">6.</span> <span class="toc_mobile_items-text">DockerFile</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#dockerFile介绍"><span class="toc_mobile_items-number">6.1.</span> <span class="toc_mobile_items-text">dockerFile介绍</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#dockerFile构建过程"><span class="toc_mobile_items-number">6.2.</span> <span class="toc_mobile_items-text">dockerFile构建过程</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#DockerFile指令"><span class="toc_mobile_items-number">6.3.</span> <span class="toc_mobile_items-text">DockerFile指令</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#实战测试"><span class="toc_mobile_items-number">6.4.</span> <span class="toc_mobile_items-text">实战测试</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#实战：tomcat镜像"><span class="toc_mobile_items-number">6.5.</span> <span class="toc_mobile_items-text">实战：tomcat镜像</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#发布自己的镜像"><span class="toc_mobile_items-number">6.6.</span> <span class="toc_mobile_items-text">发布自己的镜像</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#小结-1"><span class="toc_mobile_items-number">6.7.</span> <span class="toc_mobile_items-text">小结</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#Docker网络"><span class="toc_mobile_items-number">7.</span> <span class="toc_mobile_items-text">Docker网络</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#理解docker0"><span class="toc_mobile_items-number">7.1.</span> <span class="toc_mobile_items-text">理解docker0</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#–link"><span class="toc_mobile_items-number">7.2.</span> <span class="toc_mobile_items-text">–link</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#自定义网络"><span class="toc_mobile_items-number">7.3.</span> <span class="toc_mobile_items-text">自定义网络</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#网络连通"><span class="toc_mobile_items-number">7.4.</span> <span class="toc_mobile_items-text">网络连通</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#实战部署一个redis集群"><span class="toc_mobile_items-number">7.5.</span> <span class="toc_mobile_items-text">实战部署一个redis集群</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#Spring-Boot-打包发布docker"><span class="toc_mobile_items-number">8.</span> <span class="toc_mobile_items-text">Spring Boot 打包发布docker</span></a></li></ol></div></div><div id="body-wrap"><div id="web_bg" data-type="photo"></div><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true">     </i><div class="auto_open" id="sidebar"><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#docker安装"><span class="toc-number">1.</span> <span class="toc-text">docker安装</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#配置阿里云镜像加速"><span class="toc-number">1.1.</span> <span class="toc-text">配置阿里云镜像加速</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#底层原理"><span class="toc-number">1.2.</span> <span class="toc-text">底层原理</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#docker的常用命令"><span class="toc-number">2.</span> <span class="toc-text">docker的常用命令</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#帮助命令"><span class="toc-number">2.1.</span> <span class="toc-text">帮助命令</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#镜像命令"><span class="toc-number">2.2.</span> <span class="toc-text">镜像命令</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#容器命令"><span class="toc-number">2.3.</span> <span class="toc-text">容器命令</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#其他常用命令"><span class="toc-number">2.4.</span> <span class="toc-text">其他常用命令</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#小结"><span class="toc-number">2.5.</span> <span class="toc-text">小结</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#练习"><span class="toc-number">2.6.</span> <span class="toc-text">练习</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#"><span class="toc-number">3.</span> <span class="toc-text">Welcome to nginx!</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#可视化"><span class="toc-number">3.1.</span> <span class="toc-text">可视化</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#docker镜像讲解"><span class="toc-number">4.</span> <span class="toc-text">docker镜像讲解</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#镜像是什么"><span class="toc-number">4.1.</span> <span class="toc-text">镜像是什么</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#docker镜像加载原理"><span class="toc-number">4.2.</span> <span class="toc-text">docker镜像加载原理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#分层理解"><span class="toc-number">4.3.</span> <span class="toc-text">分层理解</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#commit镜像"><span class="toc-number">4.4.</span> <span class="toc-text">commit镜像</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#容器数据卷"><span class="toc-number">5.</span> <span class="toc-text">容器数据卷</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#什么是容器数据卷"><span class="toc-number">5.1.</span> <span class="toc-text">什么是容器数据卷</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#使用数据卷"><span class="toc-number">5.2.</span> <span class="toc-text">使用数据卷</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#mysql安装以及数据同步"><span class="toc-number">5.3.</span> <span class="toc-text">mysql安装以及数据同步</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#具名挂载和匿名挂载"><span class="toc-number">5.4.</span> <span class="toc-text">具名挂载和匿名挂载</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#初识DockerFile"><span class="toc-number">5.5.</span> <span class="toc-text">初识DockerFile</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#数据卷容器"><span class="toc-number">5.6.</span> <span class="toc-text">数据卷容器</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#DockerFile"><span class="toc-number">6.</span> <span class="toc-text">DockerFile</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#dockerFile介绍"><span class="toc-number">6.1.</span> <span class="toc-text">dockerFile介绍</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#dockerFile构建过程"><span class="toc-number">6.2.</span> <span class="toc-text">dockerFile构建过程</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#DockerFile指令"><span class="toc-number">6.3.</span> <span class="toc-text">DockerFile指令</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#实战测试"><span class="toc-number">6.4.</span> <span class="toc-text">实战测试</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#实战：tomcat镜像"><span class="toc-number">6.5.</span> <span class="toc-text">实战：tomcat镜像</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#发布自己的镜像"><span class="toc-number">6.6.</span> <span class="toc-text">发布自己的镜像</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#小结-1"><span class="toc-number">6.7.</span> <span class="toc-text">小结</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Docker网络"><span class="toc-number">7.</span> <span class="toc-text">Docker网络</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#理解docker0"><span class="toc-number">7.1.</span> <span class="toc-text">理解docker0</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#–link"><span class="toc-number">7.2.</span> <span class="toc-text">–link</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#自定义网络"><span class="toc-number">7.3.</span> <span class="toc-text">自定义网络</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#网络连通"><span class="toc-number">7.4.</span> <span class="toc-text">网络连通</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#实战部署一个redis集群"><span class="toc-number">7.5.</span> <span class="toc-text">实战部署一个redis集群</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Spring-Boot-打包发布docker"><span class="toc-number">8.</span> <span class="toc-text">Spring Boot 打包发布docker</span></a></li></ol></div></div></div><div id="content-outer"><div id="top-container" style="background-image: url(https://timgsa.baidu.com/timg?image&amp;quality=80&amp;size=b9999_10000&amp;sec=1593166873350&amp;di=8ec88b6a272f42e99b088baa56395b63&amp;imgtype=0&amp;src=http%3A%2F%2Fimg4.imgtn.bdimg.com%2Fit%2Fu%3D3899586244%2C3729560110%26fm%3D214%26gp%3D0.jpg)"><div id="post-info"><div id="post-title"><div class="posttitle">docker从入门到入门</div></div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 发表于 2020-06-26<span class="post-meta__separator">|</span><i class="fa fa-history" aria-hidden="true"></i> 更新于 2021-06-10</time><span class="post-meta__separator mobile_hidden">|</span><span class="mobile_hidden"><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/docker/">docker</a></span><div class="post-meta-wordcount"><i class="fa fa-file-word-o post-meta__icon" aria-hidden="true"></i><span>字数总计: </span><span class="word-count">4.4k</span><span class="post-meta__separator">|</span><i class="fa fa-clock-o post-meta__icon" aria-hidden="true"></i><span>阅读时长: 22 分钟</span><span class="post-meta__separator">|</span><i class="fa fa-eye post-meta__icon" aria-hidden="true">       </i><span>阅读量: </span><span id="busuanzi_value_page_pv"></span></div></div></div></div><div class="layout layout_post" id="content-inner">   <article id="post"><div class="article-container" id="post-content"><html><head></head><body><p><img alt="image-20200617183637237" data-src="http://yhaq.top/group1/M00/00/00/rBGWVV7zbjSAefstAAFpCYdh1HA884.png" class="lazyload"></p>
<p><strong>镜像（image）：</strong></p>
<p>docker镜像好比一个模板，可以通过这个模板来创建容器服务。</p>
<p><strong>容器（container）：</strong></p>
<p>Docker利用容器技术，独立运行一个或一组应用。</p>
<p>可以启动、停止、删除、基本命令。</p>
<p><strong>仓库（repository）：</strong></p>
<p>仓库就是存放镜像的地方</p>
<p>docker hub</p>
<p>阿里云</p>
<h1 id="docker安装"><a href="#docker安装" class="headerlink" title="docker安装"></a>docker安装</h1><p>1.卸载原有的docker</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">yum remove docker \</span><br><span class="line">                  docker-client \</span><br><span class="line">                  docker-client-latest \</span><br><span class="line">                  docker-common \</span><br><span class="line">                  docker-latest \</span><br><span class="line">                  docker-latest-logrotate \</span><br><span class="line">                  docker-logrotate \</span><br><span class="line">                  docker-engine</span><br></pre></td></tr></tbody></table></figure>

<p>2.安装 yum-utils来添加一个稳定的仓库</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">yum install -y yum-utils</span><br><span class="line"></span><br><span class="line">yum-config-manager \</span><br><span class="line">    --add-repo \</span><br><span class="line">    https://download.docker.com/linux/centos/docker-ce.repo</span><br></pre></td></tr></tbody></table></figure>

<p>3.安装docker</p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install docker-ce docker-ce-cli containerd.io</span><br></pre></td></tr></tbody></table></figure>

<p>4.centos8可能报错 依赖: containerd.io (>= 1.2.2-3)</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">wget https://download.docker.com/linux/centos/7/x86_64/edge/Packages/containerd.io-1.2.6-3.3.el7.x86_64.rpm</span><br><span class="line">yum -y install containerd.io-1.2.6-3.3.el7.x86_64.rpm</span><br></pre></td></tr></tbody></table></figure>

<p>5.运行测试</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">systemctl start docker</span><br><span class="line">docker run hello-world</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">root@localhost docker]# docker run hello-world</span><br><span class="line"></span><br><span class="line">Hello from Docker!</span><br><span class="line">This message shows that your installation appears to be working correctly.</span><br><span class="line"></span><br><span class="line">To generate this message, Docker took the following steps:</span><br><span class="line"> 1. The Docker client contacted the Docker daemon.</span><br><span class="line"> 2. The Docker daemon pulled the "hello-world" image from the Docker Hub.</span><br><span class="line">    (amd64)</span><br><span class="line"> 3. The Docker daemon created a new container from that image which runs the</span><br><span class="line">    executable that produces the output you are currently reading.</span><br><span class="line"> 4. The Docker daemon streamed that output to the Docker client, which sent it</span><br><span class="line">    to your terminal.</span><br><span class="line"></span><br><span class="line">To try something more ambitious, you can run an Ubuntu container with:</span><br><span class="line"><span class="meta"> $</span><span class="bash"> docker run -it ubuntu bash</span></span><br><span class="line"></span><br><span class="line">Share images, automate workflows, and more with a free Docker ID:</span><br><span class="line"> https://hub.docker.com/</span><br><span class="line"></span><br><span class="line">For more examples and ideas, visit:</span><br><span class="line"> https://docs.docker.com/get-started/</span><br></pre></td></tr></tbody></table></figure>

<p>6.查看镜像</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost docker]# docker images</span><br><span class="line">REPOSITORY          TAG                 IMAGE ID            CREATED           SIZE</span><br><span class="line">centos              latest              831691599b88        11 hours ago     215MB</span><br><span class="line">mysql               latest              be0dbf01a0f3        8 days ago       541MB</span><br><span class="line">hello-world         latest              bf756fb1ae65        5 months ago    13.3kB</span><br></pre></td></tr></tbody></table></figure>

<h2 id="配置阿里云镜像加速"><a href="#配置阿里云镜像加速" class="headerlink" title="配置阿里云镜像加速"></a>配置阿里云镜像加速</h2><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p /etc/docker</span><br><span class="line">tee /etc/docker/daemon.json <<-'EOF'</span><br><span class="line">{</span><br><span class="line">  "registry-mirrors": ["https://awn51lqb.mirror.aliyuncs.com"]</span><br><span class="line">}</span><br><span class="line">EOF</span><br><span class="line">systemctl daemon-reload</span><br><span class="line"><span class="meta">#</span><span class="bash"> 重启docker</span></span><br><span class="line">systemctl restart docker</span><br></pre></td></tr></tbody></table></figure>

<p><img alt="image-20200617190230362" data-src="http://yhaq.top/group1/M00/00/00/rBGWVV7zcFiAcERDAADxfcJed_w852.png" class="lazyload"></p>
<h2 id="底层原理"><a href="#底层原理" class="headerlink" title="底层原理"></a>底层原理</h2><p><strong>docker是怎么工作的？</strong></p>
<p>docker是一个client-server结构的系统， docker的守护进程运行在主机上。通过socket从客户端访问！</p>
<p>dockerServer接收到Docker-Client的指令，就会执行这个命令</p>
<p><img alt="image-20200617191451028" data-src="http://yhaq.top/group1/M00/00/00/rBGWVV7zcHqAVdkTAADPezPrwpw735.png" class="lazyload"></p>
<p><strong>Docker为什么比vm快？</strong></p>
<ol>
<li><p>docker有着比虚拟机更少的抽象层/</p>
</li>
<li><p>docker利用的是宿主机的内核，vm需要的是GuestOS</p>
<p><img alt="image-20200617192141457" data-src="http://yhaq.top/group1/M00/00/00/rBGWVV7zcKuAVaYQAAG2MY7QGlU960.png" class="lazyload"></p>
<p>所以，新建一个容器的时候，docker不需要像虚拟机一样重新加载一个操作系统内科，避免引导。虚拟机加载GusetOS, 分钟级别的，而docker利用的时宿主机的操作系统，省略了这个复杂过程。</p>
</li>
</ol>
<h1 id="docker的常用命令"><a href="#docker的常用命令" class="headerlink" title="docker的常用命令"></a>docker的常用命令</h1><h2 id="帮助命令"><a href="#帮助命令" class="headerlink" title="帮助命令"></a>帮助命令</h2><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker version # docker版本</span><br><span class="line">docker info # 显示docker 信息</span><br><span class="line">docker 命令 --help  # 显示命令帮助</span><br></pre></td></tr></tbody></table></figure>

<p>帮助文档地址： <a href="https://docs.docker.com/engine/reference/commandline/pull/" target="_blank" rel="noopener">https://docs.docker.com/engine/reference/commandline/pull/</a> </p>
<h2 id="镜像命令"><a href="#镜像命令" class="headerlink" title="镜像命令"></a>镜像命令</h2><p>docker images 查看本地所有镜像</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost docker]# docker images</span><br><span class="line">REPOSITORY          TAG                 IMAGE ID            CREATED           SIZE</span><br><span class="line">centos              latest              831691599b88        11 hours ago     215MB</span><br><span class="line">mysql               latest              be0dbf01a0f3        8 days ago       541MB</span><br><span class="line">hello-world         latest              bf756fb1ae65        5 months ago    13.3kB</span><br><span class="line"></span><br><span class="line">REPOSITORY	镜像的仓库源</span><br><span class="line">TAG			镜像的标签</span><br><span class="line">IMAGE ID 	镜像的ID</span><br><span class="line">CREATED 	镜像的创建时间</span><br><span class="line">SIZE		镜像的大小</span><br><span class="line"><span class="meta">#</span><span class="bash"> 可选项</span></span><br><span class="line">	-a, --all			# 列出所有镜像</span><br><span class="line">	-q, --quiet			# 只显示镜像id</span><br></pre></td></tr></tbody></table></figure>

<p>docker search 搜索镜像</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker search mysql</span><br></pre></td></tr></tbody></table></figure>

<p>docker pull 下载镜像  : 指定版本</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# docker pull mysql:5.7</span><br><span class="line">5.7: Pulling from library/mysql</span><br><span class="line">8559a31e96f4: Already exists </span><br><span class="line">d51ce1c2e575: Already exists </span><br><span class="line">c2344adc4858: Already exists </span><br><span class="line">fcf3ceff18fc: Already exists </span><br><span class="line">16da0c38dc5b: Already exists </span><br><span class="line">b905d1797e97: Already exists </span><br><span class="line">4b50d1c6b05c: Already exists </span><br><span class="line">d85174a87144: Pull complete </span><br><span class="line">a4ad33703fa8: Pull complete </span><br><span class="line">f7a5433ce20d: Pull complete </span><br><span class="line">3dcd2a278b4a: Pull complete </span><br><span class="line">Digest: sha256:32f9d9a069f7a735e28fd44ea944d53c61f990ba71460c5c183e610854ca4854</span><br><span class="line">Status: Downloaded newer image for mysql:5.7</span><br><span class="line">docker.io/library/mysql:5.7</span><br></pre></td></tr></tbody></table></figure>

<p>docker rmi -f </p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# docker images</span><br><span class="line">REPOSITORY          TAG                 IMAGE ID            CREATED           SIZE</span><br><span class="line">centos              latest              831691599b88        11 hours ago     215MB</span><br><span class="line">mysql               5.7                 9cfcce23593a        8 days ago       448MB</span><br><span class="line">mysql               latest              be0dbf01a0f3        8 days ago       541MB</span><br><span class="line">hello-world         latest              bf756fb1ae65        5 months ago    13.3kB</span><br><span class="line">[root@localhost ~]# docker rmi -f 9cfcce23593a</span><br><span class="line">Untagged: mysql:5.7</span><br><span class="line">Untagged: mysql@sha256:32f9d9a069f7a735e28fd44ea944d53c61f990ba71460c5c183e610854ca4854</span><br><span class="line">Deleted: sha256:9cfcce23593a93135ca6dbf3ed544d1db9324d4c40b5c0d56958165bfaa2d46a</span><br><span class="line">Deleted: sha256:98de3e212919056def8c639045293658f6e6022794807d4b0126945ddc8324be</span><br><span class="line">Deleted: sha256:17e8b88858e400f8c5e10e7cb3fbab9477f6d8aacba03b8167d34a91dbe4d8c1</span><br><span class="line">Deleted: sha256:c04c087c2af9abd64ba32fe89d65e6d83da514758923de5da154541cc01a3a1e</span><br><span class="line">Deleted: sha256:ab8bf065b402b99aec4f12c648535ef1b8dc954b4e1773bdffa10ae2027d3e00</span><br><span class="line"></span><br><span class="line">docker rmi -f 镜像id </span><br><span class="line">docker rmi -f 镜像id 镜像id 镜像id 镜像id # 删除多个</span><br><span class="line">docker rmi -f $(docker images -aq) # 删除所有 ，先查出所有镜像id 然后返回</span><br></pre></td></tr></tbody></table></figure>



<h2 id="容器命令"><a href="#容器命令" class="headerlink" title="容器命令"></a>容器命令</h2><p>说明：我们有了镜像才可以创建容器，linux，下载一个centos镜像</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull centos</span><br></pre></td></tr></tbody></table></figure>

<p><strong>启动centos</strong></p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">docker run [可选参数] image</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 参数说明</span></span><br><span class="line">--name="Name" 		容器名字 tomcat01 tomcat02 tomcat03</span><br><span class="line">-d 					后台方式启动</span><br><span class="line">-it					使用交互方式启动，进入容器查看内容</span><br><span class="line">-P</span><br><span class="line">	-P ip:主机端口:容器端口</span><br><span class="line">	-P 主机端口:容器端口 （常用）</span><br><span class="line">	-P 容器端口</span><br><span class="line">-p 		指定随机端口</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 测试</span></span><br><span class="line">[root@localhost ~]# docker run -it centos /bin/bash</span><br><span class="line">[root@bf449a6602c7 /]# ls</span><br><span class="line">bin  etc   lib	  lost+found  mnt  proc  run   srv  tmp  var</span><br><span class="line">dev  home  lib64  media       opt  root  sbin  sys  usr</span><br><span class="line"><span class="meta">#</span><span class="bash"> 推出</span></span><br><span class="line">exit</span><br><span class="line">[root@bf449a6602c7 /]# exit</span><br><span class="line">exit</span><br><span class="line">[root@localhost ~]#</span><br></pre></td></tr></tbody></table></figure>

<p><strong>列出所有的运行的容器</strong></p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">docker ps </span><br><span class="line">-a # 列出所有</span><br><span class="line">-n=? # 显示最近创建的容器</span><br><span class="line">-q # 只显示编号</span><br></pre></td></tr></tbody></table></figure>

<p><strong>退出容器</strong></p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">exit</span><br><span class="line">Ctrl + P + D # 退出不停止</span><br></pre></td></tr></tbody></table></figure>

<p><strong>删除容器</strong></p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker rm 容器id				 # 删除指定容器 </span><br><span class="line">docker rm -f $(docker ps -aq) # 删除所有容器</span><br></pre></td></tr></tbody></table></figure>



<p><strong>启动和停止容器</strong></p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">docker start 容器id</span><br><span class="line">docker restart 容器id</span><br><span class="line">docker stop 容器id</span><br><span class="line">docker kill 容器id</span><br></pre></td></tr></tbody></table></figure>





<h2 id="其他常用命令"><a href="#其他常用命令" class="headerlink" title="其他常用命令"></a>其他常用命令</h2><p><strong>后台运行容器</strong></p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">docker run -d centos</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 问题docker ps，发现centos 停止了</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 常见的坑: docker 容器使用后台运行，就必须要有要一个前台进程，docker发现没有应用，就会自动停止</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> nginx, 容器启动后，发现自己没有提供服务，就会立刻停止，就是没有程序了</span></span><br></pre></td></tr></tbody></table></figure>

<p><strong>查看日志</strong></p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">docker logs -f -t --taill 容器id</span><br><span class="line"></span><br><span class="line">docker ps </span><br><span class="line">[root@localhost ~]# docker ps</span><br><span class="line">CONTAINER ID        IMAGE              NAMES</span><br><span class="line">735ecca8de6c       </span><br><span class="line"></span><br><span class="line">root@localhost ~]# docker logs -tf --tail 10 735ecca8de6c</span><br><span class="line">2020-06-17T13:43:28.891672723Z yhq</span><br><span class="line">2020-06-17T13:43:29.898404958Z yhq</span><br><span class="line">2020-06-17T13:43:30.901205379Z yhq</span><br><span class="line">2020-06-17T13:43:31.904818805Z yhq</span><br><span class="line">2020-06-17T13:43:32.941032982Z yhq</span><br><span class="line">2020-06-17T13:43:33.946653747Z yhq</span><br><span class="line">2020-06-17T13:43:34.956068511Z yhq</span><br><span class="line">2020-06-17T13:43:35.959693326Z yhq</span><br><span class="line">2020-06-17T13:43:36.965487505Z yhq</span><br><span class="line">2020-06-17T13:43:37.967542149Z yhq</span><br><span class="line">2020-06-17T13:43:38.970264944Z yhq</span><br><span class="line">2020-06-17T13:43:39.976646576Z yhq</span><br><span class="line">2020-06-17T13:43:40.982509944Z yhq</span><br><span class="line"><span class="meta">#</span><span class="bash"> 显示日志</span></span><br><span class="line">	-tf # 显示日志</span><br><span class="line">	--tail number # 显示日志的条数</span><br></pre></td></tr></tbody></table></figure>

<p><strong>查看容器中的进程信息</strong></p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# docker top 735ecca8de6c</span><br><span class="line">UID                 PID                 PPID                C                   STIME               TTY                 TIME                CMD</span><br><span class="line">root                45448               45431               0                   09:40               ?                   00:00:00            /bin/bash -c while true; do echo yhq;sleep 1;done</span><br><span class="line">[root@localhost ~]#</span><br></pre></td></tr></tbody></table></figure>

<p><strong>查看容器的信息</strong></p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# docker inspect  735ecca8de6c</span><br><span class="line">[</span><br><span class="line">    {</span><br><span class="line">        "Id": "735ecca8de6c6d333fbc1251ce3fff34344ca0a8c898ce648fb8e497ca2e5619",</span><br><span class="line">        "Created": "2020-06-17T13:40:47.248425309Z",</span><br><span class="line">        "Path": "/bin/bash",</span><br><span class="line">        "Args": [</span><br><span class="line">            "-c",</span><br><span class="line">            "while true; do echo yhq;sleep 1;done"</span><br><span class="line">        ],</span><br><span class="line">        "State": {</span><br><span class="line">            "Status": "running",</span><br><span class="line">            "Running": true,</span><br><span class="line">            "Paused": false,</span><br><span class="line">            "Restarting": false,</span><br><span class="line">            "OOMKilled": false,</span><br><span class="line">            "Dead": false,</span><br><span class="line">            "Pid": 45448,</span><br><span class="line">            "ExitCode": 0,</span><br><span class="line">            "Error": "",</span><br><span class="line">            "StartedAt": "2020-06-17T13:40:49.26455631Z",</span><br><span class="line">            "FinishedAt": "0001-01-01T00:00:00Z"</span><br><span class="line">        },</span><br><span class="line">        "Image": "sha256:831691599b88ad6cc2a4abbd0e89661a121aff14cfa289ad840fd3946f274f1f",</span><br><span class="line">        "ResolvConfPath": "/var/lib/docker/containers/735ecca8de6c6d333fbc1251ce3fff34344ca0a8c898ce648fb8e497ca2e5619/resolv.conf",</span><br><span class="line">        "HostnamePath": "/var/lib/docker/containers/735ecca8de6c6d333fbc1251ce3fff34344ca0a8c898ce648fb8e497ca2e5619/hostname",</span><br><span class="line">        "HostsPath": "/var/lib/docker/containers/735ecca8de6c6d333fbc1251ce3fff34344ca0a8c898ce648fb8e497ca2e5619/hosts",</span><br><span class="line">        "LogPath": "/var/lib/docker/containers/735ecca8de6c6d333fbc1251ce3fff34344ca0a8c898ce648fb8e497ca2e5619/735ecca8de6c6d333fbc1251ce3fff34344ca0a8c898ce648fb8e497ca2e5619-json.log",</span><br><span class="line">        "Name": "/sleepy_leavitt",</span><br><span class="line">        "RestartCount": 0,</span><br><span class="line">        "Driver": "overlay2",</span><br><span class="line">        "Platform": "linux",</span><br><span class="line">        "MountLabel": "",</span><br><span class="line">        "ProcessLabel": "",</span><br><span class="line">        "AppArmorProfile": "",</span><br><span class="line">        "ExecIDs": null,</span><br><span class="line">        "HostConfig": {</span><br><span class="line">            "Binds": null,</span><br><span class="line">            "ContainerIDFile": "",</span><br><span class="line">            "LogConfig": {</span><br><span class="line">                "Type": "json-file",</span><br><span class="line">                "Config": {}</span><br><span class="line">            },</span><br><span class="line">            "NetworkMode": "default",</span><br><span class="line">            "PortBindings": {},</span><br><span class="line">            "RestartPolicy": {</span><br><span class="line">                "Name": "no",</span><br><span class="line">                "MaximumRetryCount": 0</span><br><span class="line">            },</span><br><span class="line">            "AutoRemove": false,</span><br><span class="line">            "VolumeDriver": "",</span><br><span class="line">            "VolumesFrom": null,</span><br><span class="line">            "CapAdd": null,</span><br><span class="line">            "CapDrop": null,</span><br><span class="line">            "Capabilities": null,</span><br><span class="line">            "Dns": [],</span><br><span class="line">            "DnsOptions": [],</span><br><span class="line">            "DnsSearch": [],</span><br><span class="line">            "ExtraHosts": null,</span><br><span class="line">            "GroupAdd": null,</span><br><span class="line">            "IpcMode": "private",</span><br><span class="line">            "Cgroup": "",</span><br><span class="line">            "Links": null,</span><br><span class="line">            "OomScoreAdj": 0,</span><br><span class="line">            "PidMode": "",</span><br><span class="line">            "Privileged": false,</span><br><span class="line">            "PublishAllPorts": false,</span><br><span class="line">            "ReadonlyRootfs": false,</span><br><span class="line">            "SecurityOpt": null,</span><br><span class="line">            "UTSMode": "",</span><br><span class="line">            "UsernsMode": "",</span><br><span class="line">            "ShmSize": 67108864,</span><br><span class="line">            "Runtime": "runc",</span><br><span class="line">            "ConsoleSize": [</span><br><span class="line">                0,</span><br><span class="line">                0</span><br><span class="line">            ],</span><br><span class="line">            "Isolation": "",</span><br><span class="line">            "CpuShares": 0,</span><br><span class="line">            "Memory": 0,</span><br><span class="line">            "NanoCpus": 0,</span><br><span class="line">            "CgroupParent": "",</span><br><span class="line">            "BlkioWeight": 0,</span><br><span class="line">            "BlkioWeightDevice": [],</span><br><span class="line">            "BlkioDeviceReadBps": null,</span><br><span class="line">            "BlkioDeviceWriteBps": null,</span><br><span class="line">            "BlkioDeviceReadIOps": null,</span><br><span class="line">            "BlkioDeviceWriteIOps": null,</span><br><span class="line">            "CpuPeriod": 0,</span><br><span class="line">            "CpuQuota": 0,</span><br><span class="line">            "CpuRealtimePeriod": 0,</span><br><span class="line">            "CpuRealtimeRuntime": 0,</span><br><span class="line">            "CpusetCpus": "",</span><br><span class="line">            "CpusetMems": "",</span><br><span class="line">            "Devices": [],</span><br><span class="line">            "DeviceCgroupRules": null,</span><br><span class="line">            "DeviceRequests": null,</span><br><span class="line">            "KernelMemory": 0,</span><br><span class="line">            "KernelMemoryTCP": 0,</span><br><span class="line">            "MemoryReservation": 0,</span><br><span class="line">            "MemorySwap": 0,</span><br><span class="line">            "MemorySwappiness": null,</span><br><span class="line">            "OomKillDisable": false,</span><br><span class="line">            "PidsLimit": null,</span><br><span class="line">            "Ulimits": null,</span><br><span class="line">            "CpuCount": 0,</span><br><span class="line">            "CpuPercent": 0,</span><br><span class="line">            "IOMaximumIOps": 0,</span><br><span class="line">            "IOMaximumBandwidth": 0,</span><br><span class="line">            "MaskedPaths": [</span><br><span class="line">                "/proc/asound",</span><br><span class="line">                "/proc/acpi",</span><br><span class="line">                "/proc/kcore",</span><br><span class="line">                "/proc/keys",</span><br><span class="line">                "/proc/latency_stats",</span><br><span class="line">                "/proc/timer_list",</span><br><span class="line">                "/proc/timer_stats",</span><br><span class="line">                "/proc/sched_debug",</span><br><span class="line">                "/proc/scsi",</span><br><span class="line">                "/sys/firmware"</span><br><span class="line">            ],</span><br><span class="line">            "ReadonlyPaths": [</span><br><span class="line">                "/proc/bus",</span><br><span class="line">                "/proc/fs",</span><br><span class="line">                "/proc/irq",</span><br><span class="line">                "/proc/sys",</span><br><span class="line">                "/proc/sysrq-trigger"</span><br><span class="line">            ]</span><br><span class="line">        },</span><br><span class="line">        "GraphDriver": {</span><br><span class="line">            "Data": {</span><br><span class="line">                "LowerDir": "/var/lib/docker/overlay2/bad0bcca288f50100138666ac67996b9cca34d2efc047ed7ea7ad04576be7806-init/diff:/var/lib/docker/overlay2/0bdc35d6430a7aaa1a950263583b982dea9dc29de099456f7b1bb36ef9319f1a/diff",</span><br><span class="line">                "MergedDir": "/var/lib/docker/overlay2/bad0bcca288f50100138666ac67996b9cca34d2efc047ed7ea7ad04576be7806/merged",</span><br><span class="line">                "UpperDir": "/var/lib/docker/overlay2/bad0bcca288f50100138666ac67996b9cca34d2efc047ed7ea7ad04576be7806/diff",</span><br><span class="line">                "WorkDir": "/var/lib/docker/overlay2/bad0bcca288f50100138666ac67996b9cca34d2efc047ed7ea7ad04576be7806/work"</span><br><span class="line">            },</span><br><span class="line">            "Name": "overlay2"</span><br><span class="line">        },</span><br><span class="line">        "Mounts": [],</span><br><span class="line">        "Config": {</span><br><span class="line">            "Hostname": "735ecca8de6c",</span><br><span class="line">            "Domainname": "",</span><br><span class="line">            "User": "",</span><br><span class="line">            "AttachStdin": false,</span><br><span class="line">            "AttachStdout": false,</span><br><span class="line">            "AttachStderr": false,</span><br><span class="line">            "Tty": false,</span><br><span class="line">            "OpenStdin": false,</span><br><span class="line">            "StdinOnce": false,</span><br><span class="line">            "Env": [</span><br><span class="line">                "PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin"</span><br><span class="line">            ],</span><br><span class="line">            "Cmd": [</span><br><span class="line">                "/bin/bash",</span><br><span class="line">                "-c",</span><br><span class="line">                "while true; do echo yhq;sleep 1;done"</span><br><span class="line">            ],</span><br><span class="line">            "Image": "centos",</span><br><span class="line">            "Volumes": null,</span><br><span class="line">            "WorkingDir": "",</span><br><span class="line">            "Entrypoint": null,</span><br><span class="line">            "OnBuild": null,</span><br><span class="line">            "Labels": {</span><br><span class="line">                "org.label-schema.build-date": "20200611",</span><br><span class="line">                "org.label-schema.license": "GPLv2",</span><br><span class="line">                "org.label-schema.name": "CentOS Base Image",</span><br><span class="line">                "org.label-schema.schema-version": "1.0",</span><br><span class="line">                "org.label-schema.vendor": "CentOS"</span><br><span class="line">            }</span><br><span class="line">        },</span><br><span class="line">        "NetworkSettings": {</span><br><span class="line">            "Bridge": "",</span><br><span class="line">            "SandboxID": "88ffd90f2d00271088c2f8e87a139eb625a1ed91e8d7196fc5a10b34a3352fbc",</span><br><span class="line">            "HairpinMode": false,</span><br><span class="line">            "LinkLocalIPv6Address": "",</span><br><span class="line">            "LinkLocalIPv6PrefixLen": 0,</span><br><span class="line">            "Ports": {},</span><br><span class="line">            "SandboxKey": "/var/run/docker/netns/88ffd90f2d00",</span><br><span class="line">            "SecondaryIPAddresses": null,</span><br><span class="line">            "SecondaryIPv6Addresses": null,</span><br><span class="line">            "EndpointID": "85b2c83e7541e2cf5ace7d997426132f1ae4682ed805dac0f057efb402580f08",</span><br><span class="line">            "Gateway": "172.17.0.1",</span><br><span class="line">            "GlobalIPv6Address": "",</span><br><span class="line">            "GlobalIPv6PrefixLen": 0,</span><br><span class="line">            "IPAddress": "172.17.0.2",</span><br><span class="line">            "IPPrefixLen": 16,</span><br><span class="line">            "IPv6Gateway": "",</span><br><span class="line">            "MacAddress": "02:42:ac:11:00:02",</span><br><span class="line">            "Networks": {</span><br><span class="line">                "bridge": {</span><br><span class="line">                    "IPAMConfig": null,</span><br><span class="line">                    "Links": null,</span><br><span class="line">                    "Aliases": null,</span><br><span class="line">                    "NetworkID": "fc174f87c26d613089f3ba6c553b0c48f71b87f255784da02fdda4741e10cbc3",</span><br><span class="line">                    "EndpointID": "85b2c83e7541e2cf5ace7d997426132f1ae4682ed805dac0f057efb402580f08",</span><br><span class="line">                    "Gateway": "172.17.0.1",</span><br><span class="line">                    "IPAddress": "172.17.0.2",</span><br><span class="line">                    "IPPrefixLen": 16,</span><br><span class="line">                    "IPv6Gateway": "",</span><br><span class="line">                    "GlobalIPv6Address": "",</span><br><span class="line">                    "GlobalIPv6PrefixLen": 0,</span><br><span class="line">                    "MacAddress": "02:42:ac:11:00:02",</span><br><span class="line">                    "DriverOpts": null</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">]</span><br></pre></td></tr></tbody></table></figure>



<p><strong>进入正在运行的容器</strong></p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 通常容器都是后台运行，需要进入容器修改一些配置</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 命令</span></span><br><span class="line">docker exec -it 容器id bashShell</span><br><span class="line"></span><br><span class="line">[root@localhost ~]# docker exec -it 735ecca8de6c /bin/bash</span><br><span class="line">[root@735ecca8de6c /]# </span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 方式二</span></span><br><span class="line">docker attach 735ecca8de6c</span><br><span class="line">正在执行的代码。。。。</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> docker <span class="built_in">exec</span> 进入容器后开启一个新的终端</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> docker attach <span class="comment"># 进入正在执行的终端，不会启动新的终端</span></span></span><br></pre></td></tr></tbody></table></figure>

<p><strong>从容器内拷贝文件到主机上</strong></p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">docker cp 容器id:容器内路径  目的的主机路径</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 新建一个centos</span></span><br><span class="line">[root@localhost ~]# docker run -it centos /bin/bash</span><br><span class="line">[root@af99c406c29b /]# cd /h0ome</span><br><span class="line">bash: cd: /h0ome: No such file or directory</span><br><span class="line">[root@af99c406c29b /]# cd /home</span><br><span class="line">[root@af99c406c29b home]# ll</span><br><span class="line">bash: ll: command not found</span><br><span class="line">[root@af99c406c29b home]# ls </span><br><span class="line"><span class="meta">#</span><span class="bash"> 新建一个文件</span></span><br><span class="line">[root@af99c406c29b home]# touch test.java</span><br><span class="line">[root@af99c406c29b home]# ls > test.java</span><br><span class="line">[root@af99c406c29b home]# exit</span><br><span class="line">exit</span><br><span class="line">[root@localhost ~]# </span><br><span class="line">[root@localhost ~]# docker ps -a</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS                            PORTS               NAMES</span><br><span class="line">af99c406c29b        centos              "/bin/bash"              53 seconds ago      Exited (0) 14 seconds ago                             heuristic_newton</span><br><span class="line">bb992db2ad4c        centos              "/bin/bash"              2 minutes ago       Exited (137) About a minute ago                       strange_cray</span><br><span class="line">735ecca8de6c        centos              "/bin/bash -c 'while…"   36 minutes ago      Exited (137) 3 minutes ago                            sleepy_leavitt</span><br><span class="line">6769c344dbe0        centos              "/bin/bash"              38 minutes ago      Exited (137) 36 minutes ago                           focused_cartwright</span><br><span class="line">91762b278fba        centos              "/bin/bash"              42 minutes ago      Exited (0) 41 minutes ago                             practical_galois</span><br><span class="line">e2c307e28893        mysql               "docker-entrypoint.s…"   45 minutes ago      Exited (127) 44 minutes ago                           elastic_hopper</span><br><span class="line"><span class="meta">#</span><span class="bash"> 将af99c406c29b 的test.java cp出来</span></span><br><span class="line">[root@localhost ~]# docker cp af99c406c29b:/home/test.java /home</span><br><span class="line">[root@localhost ~]# cd /home</span><br><span class="line">[root@localhost home]# cat test.java</span><br><span class="line">test.java</span><br><span class="line">[root@localhost home]#</span><br></pre></td></tr></tbody></table></figure>

<h2 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h2><p><img alt="image-20200617222000947" data-src="http://yhaq.top/group1/M00/00/00/rBGWVV7zcN-Ae5zsAAN9LIV5W4E597.png" class="lazyload"></p>
<h2 id="练习"><a href="#练习" class="headerlink" title="练习"></a>练习</h2><p>Docker安装配置nginx</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">[root@iz2zege5xssb2avm6if6l8z ~]# docker pull nginx</span><br><span class="line">Using default tag: latest</span><br><span class="line">latest: Pulling from library/nginx</span><br><span class="line">8559a31e96f4: Pull complete </span><br><span class="line">8d69e59170f7: Pull complete </span><br><span class="line">3f9f1ec1d262: Pull complete </span><br><span class="line">d1f5ff4f210d: Pull complete </span><br><span class="line">1e22bfa8652e: Pull complete </span><br><span class="line">Digest: sha256:21f32f6c08406306d822a0e6e8b7dc81f53f336570e852e25fbe1e3e3d0d0133</span><br><span class="line">Status: Downloaded newer image for nginx:latest</span><br><span class="line">docker.io/library/nginx:latest</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> -d 后台启动  --name 设置容器名  -p设置容器端口号   左边是外部端口右边是容器端口</span></span><br><span class="line">[root@iz2zege5xssb2avm6if6l8z ~]# docker run -d --name nginx01 -p 3344:80 nginx</span><br><span class="line">e2447c80eb479a72c226fd809d7fc103d05197d82eac483e1e67058d5656de39</span><br><span class="line">[root@iz2zege5xssb2avm6if6l8z ~]# </span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 测试</span></span><br><span class="line"></span><br><span class="line">[root@iz2zege5xssb2avm6if6l8z ~]# curl localhost:3344</span><br><span class="line"><!DOCTYPE html></span><br><span class="line"><html></span><br><span class="line"><head></span><br><span class="line"><title>Welcome to nginx!</title></span><br><span class="line"><style></span><br><span class="line">    body {</span><br><span class="line">        width: 35em;</span><br><span class="line">        margin: 0 auto;</span><br><span class="line">        font-family: Tahoma, Verdana, Arial, sans-serif;</span><br><span class="line">    }</span><br><span class="line"></style></span><br><span class="line"></head></span><br><span class="line"><body></span><br><span class="line"><h1>Welcome to nginx!</h1></span><br><span class="line"><p>If you see this page, the nginx web server is successfully installed and</span><br><span class="line">working. Further configuration is required.</p></span><br><span class="line"></span><br><span class="line"><p>For online documentation and support please refer to</span><br><span class="line"><a href="http://nginx.org/" target="_blank" rel="noopener">nginx.org</a>.<br/></span><br><span class="line">Commercial support is available at</span><br><span class="line"><a href="http://nginx.com/" target="_blank" rel="noopener">nginx.com</a>.</p></span><br><span class="line"></span><br><span class="line"><p><em>Thank you for using nginx.</em></p></span><br><span class="line"></body></span><br><span class="line"></html></span><br><span class="line">[root@iz2zege5xssb2avm6if6l8z ~]#</span><br></pre></td></tr></tbody></table></figure>

<blockquote>
<p>端口映射   左边为外网的端口，右边为容器的端口，外网访问通过左边的端口号，找到右边的容器端口号</p>
</blockquote>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 进入容器中，对nginx进行配置</span></span><br><span class="line"></span><br><span class="line">[root@iz2zege5xssb2avm6if6l8z ~]# docker exec -it nginx01 /bin/bash</span><br><span class="line">root@82f58a0cc4fb:/# ls</span><br><span class="line">bin  boot  dev  docker-entrypoint.d  docker-entrypoint.sh  etc  home  lib  lib64  media  mnt  opt  proc  root  run  sbin  srv  sys  tmp  usr  var</span><br><span class="line">root@82f58a0cc4fb:/# whereis nginx</span><br><span class="line">nginx: /usr/sbin/nginx /usr/lib/nginx /etc/nginx /usr/share/nginx</span><br><span class="line">root@82f58a0cc4fb:/# cd /etc/nginx</span><br><span class="line">root@82f58a0cc4fb:/etc/nginx# ls</span><br><span class="line">conf.d  fastcgi_params  koi-utf  koi-win  mime.types  modules  nginx.conf  scgi_params  uwsgi_params  win-utf</span><br><span class="line">root@82f58a0cc4fb:/etc/nginx#</span><br></pre></td></tr></tbody></table></figure>



<p>docker安装tomcat</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 官方的使用</span></span><br><span class="line">docker run -it --rm tomcat:9.0</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> --rm是使用完之后直接删除</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 安装过程</span></span><br><span class="line"></span><br><span class="line">docker pull tomcat</span><br><span class="line"></span><br><span class="line">docker run -d -p 39008:8080 --name tomcat01 tomcat</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 测试访问正确</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 进入容器</span></span><br><span class="line"></span><br><span class="line">[root@iz2zege5xssb2avm6if6l8z ~]# docker exec -it tomcat01 /bin/bash</span><br><span class="line">root@3b27be139d04:/usr/local/tomcat# ls</span><br><span class="line">BUILDING.txt     LICENSE  README.md      RUNNING.txt  conf  logs            temp     webapps.dist</span><br><span class="line">CONTRIBUTING.md  NOTICE   RELEASE-NOTES  bin          lib   native-jni-lib  webapps  work</span><br><span class="line">root@3b27be139d04:/usr/local/tomcat# cd webapps</span><br><span class="line">root@3b27be139d04:/usr/local/tomcat/webapps# ls</span><br><span class="line">root@3b27be139d04:/usr/local/tomcat/webapps# vim</span><br><span class="line">bash: vim: command not found</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 发现linux一些命令都不在  ，webapps中没有文件   ， 因为tomcat容器中剔除了不必要的一些配置</span></span><br></pre></td></tr></tbody></table></figure>





<p>docker部署es+kibana</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 安装es之前关闭其他容器 因为es占用大量内存</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> es的数据一般需要放置到安全目录，挂载</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> --net somenetwork 网络设置 这里先删掉</span></span><br><span class="line">docker pull elasticsearch:7.6.2</span><br><span class="line">docker run -d --name elasticsearch -p 9200:9200 -p 9300:9300 -e "discovery.type=single-node" elasticsearch:7.6.2</span><br><span class="line">docker stats # 查看状态</span><br></pre></td></tr></tbody></table></figure>

<p><img alt="image-20200621113602928" data-src="http://yhaq.top/group1/M00/00/00/rBGWVV7zcS-AMmbnAAAcaM8Z708809.png" class="lazyload"></p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 加-e配置jvm使用内存</span></span><br><span class="line">docker run -d --name elasticsearch -p 9200:9200 -p 9300:9300 -e "discovery.type=single-node" -e ES_JAVA_OPTS="-Xms64m -Xmx512m" elasticsearch:7.6.2</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看stats</span></span><br></pre></td></tr></tbody></table></figure>

<p><img alt="image-20200621114248143" data-src="http://yhaq.top/group1/M00/00/00/rBGWVV7zcUOADPn7AAAe8xndLRg146.png" class="lazyload"></p>
<h2 id="可视化"><a href="#可视化" class="headerlink" title="可视化"></a>可视化</h2><ul>
<li>portainer</li>
</ul>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker run -d -p 8088:9000 \</span><br><span class="line">--restart=always -v /var/run/docker.sock:/var/run/docker.sock --privileged=true portainer/portainer</span><br></pre></td></tr></tbody></table></figure>

<ul>
<li>Rancher</li>
</ul>
<p><strong>什么是portainer？</strong></p>
<p>Docker图形化界面管理工具，提供一个后台面板供我们操作</p>
<p><img alt="image-20200621115522169" data-src="http://yhaq.top/group1/M00/00/00/rBGWVV7zcWaADrTYAADl-KwQUxM815.png" class="lazyload"></p>
<p><img alt="image-20200621115534999" data-src="http://yhaq.top/group1/M00/00/00/rBGWVV7zcYqAAKTLAAGE0e2bUyk902.png" class="lazyload"></p>
<h1 id="docker镜像讲解"><a href="#docker镜像讲解" class="headerlink" title="docker镜像讲解"></a>docker镜像讲解</h1><h2 id="镜像是什么"><a href="#镜像是什么" class="headerlink" title="镜像是什么"></a>镜像是什么</h2><p>镜像是一种轻量级、可执行的独立软件包,用来打包软件运行环境和基于运行环境开发的软件,它包含运行某个软件所需的所有内容,包括代码、运行时、库、环境变量和配置文件。</p>
<p>所有的应用,直接打包docker镜像,就可以直接跑起来!</p>
<h2 id="docker镜像加载原理"><a href="#docker镜像加载原理" class="headerlink" title="docker镜像加载原理"></a>docker镜像加载原理</h2><blockquote>
<p>UnionFS ( 联合文件系统)</p>
</blockquote>
<p>下载的时候看到的一层层的就是这个</p>
<p>UnionFS (联合文件系统) : Union文件系统( UnionFS)是一种分层、 轻量级并且高性能的文件系统,它支持对文件系统的修改作为一次提交来于层层的叠加,同时可以将不同目录挂载到同一个虚拟文件系统(unite several directories into a single virtualfilesystem)。Union 文件系统是Docker镜像的基础。镜像可以通过分层来进行继承,基于基础镜(没有父镜像) ,可以制作各种具体的应用镜像。</p>
<p>特性: 一次同时加载多个文件系统,但从外面看起来,只能看到一个文件系统,联合加载会把各层文件系统叠加起来,这样最终的文件系统会包含所有底层的文件和目录</p>
<blockquote>
<p>Docker镜像加载原理</p>
</blockquote>
<p>docker的镜像实际上由一层一层的文件系统组成,这种层级的文件系统UnionFS.</p>
<p>bootfs(boot file system)主要包含bootloader和kernel, bootloader主要是引导加载kernel, Linux刚启动时会加载bootfs文件系统,在Docker镜像的最底层是bootfs。这一层与我们典型的Linux/Unix系统是一样的,包含boot加载器和内核。当boot加载完成之后整个内核就都在内存中了,此时内存的使用权已由bootfs转交给内核,此时系统也会卸载bootfs.</p>
<p>rootfs (root file system) ,在bootfs之上。包含的就是典型Linux系统中的/dev, /proc, /bin, /etc等标准目录和文件。rootfs就是各种不同的操作系统发行版,比如Ubuntu , Centos等等。</p>
<p><img alt="image-20200621120425542" data-src="http://yhaq.top/group1/M00/00/00/rBGWVV7zcauAEEhnAAJ-3tLgBpM390.png" class="lazyload"></p>
<p>平时我们安装虚拟机的centos都好几G为什么docker 才200M</p>
<p><img alt="image-20200621120617547" data-src="http://yhaq.top/group1/M00/00/00/rBGWVV7zcdOAURBXAADfi4EmVE0265.png" class="lazyload"></p>
<p>对于一个精简的OS , rootfs可以很小,只需要包含最基本的命令,工具和程序库就可以了,因为底层直接用Host的kernel,自己只需要提供rootfs就可以了。由此可见对于不同的linux发行版, bootfs基本是一致的, rootfs会有差别,因此不同的发行版可以公用bootfs.</p>
<h2 id="分层理解"><a href="#分层理解" class="headerlink" title="分层理解"></a>分层理解</h2><p><strong>思考:为什么Docker镜像要采用这种分层的结构呢?</strong><br>最大的好处,我觉得莫过于是资源共享了!比如有多个镜像都从相同的Base镜像构建而来,那么宿主机只需在磁盘上保留一份base镜像,同时内存中也只需要加载一份base镜像 ,这样就可以为所有的容器服务了,而且镜像的每一层都可以被共享。</p>
<p>我们可以去下载一个镜像,注意观察下载的日志输出,可以看到是一层一层的在下载!</p>
<p>查看镜像分层的方式可以通过docker image inspect令!</p>
<figure class="highlight"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">"RootFS": {</span><br><span class="line">            "Type": "layers",</span><br><span class="line">            "Layers": [</span><br><span class="line">                    "sha256:13cb14c2acd34e45446a50af25cb05095a17624678dbafbcc9e26086547c1d74",</span><br><span class="line">                    "sha256:d4cf327d8ef50eb2e31b646f17217a3baf455391bfd59bce47df50c770ff8c07",</span><br><span class="line">                    "sha256:7c7d7f4461826dd22f9234a81f9bed9c0bdb0b70b3ce66228bfc87418a9b8313",</span><br><span class="line">                    "sha256:9040af41bb6677b114134de15ddeb10b070eb1f940dbbe277574ee154d89f6b9",</span><br><span class="line">                    <span class="string">"sha256:f978b9ed3f26a49b55cf4849e4cadb29335be45a633cbe95a2f4e445e70086bf"</span></span><br><span class="line">            ]</span><br><span class="line"> },</span><br></pre></td></tr></tbody></table></figure>

<p><strong>理解</strong></p>
<p>所有的Docker镜像都起始于一个基础镜像层 ,当进行修改或增加新的内容时,就会在当前镜像层之上,创建新的镜像层。</p>
<p>举一个简单的例子,假如基于Ubuntu Linux 16.04创建一个新的镜像 ,这就是新镜像的第一层 ;如果在该镜像中添加Python包就会在基础镜像层之上创建第二个镜像层;如果继续添加一个安全补丁,就会创建第三个镜像层。</p>
<p>该镜像当前已经包含3个镜像层,如下图所示(这只是一个用于演示的很简单的例子 )。</p>
<p><img alt="image-20200621164010875" data-src="http://yhaq.top/group1/M00/00/00/rBGWVV7zcfmALb0oAAD8FapXC5E757.png" class="lazyload"></p>
<p>在添加额外的镜像层的同时, 镜像始终保持是当前所有镜像的组合,理解这一点非常重要。下图中举了一个简单的例子,每个镜像层包含3个文件,而镜像包含了来自两个镜像层的6个文件。</p>
<p><img alt="image-20200621164035837" data-src="http://yhaq.top/group1/M00/00/00/rBGWVV7zchSAcwPTAADInPN0cBs820.png" class="lazyload"></p>
<p>上图中的镜像层跟之前图中的略有区别,主要目的是便于展示文件。</p>
<p>下图中展示了一个稍微复杂的三层镜像,在外部看来整个镜像只有6个文件,这是因为最上层中的文件7文件5的一个更新版本。</p>
<p><img alt="image-20200621164122978" data-src="http://yhaq.top/group1/M00/00/00/rBGWVV7zciuAc8TuAAFXdYgFrMQ473.png" class="lazyload"></p>
<p>这种情况下,上层镜像层中的文件覆盖了底层镜像层中的文件。这样就使得文件的更新版本作为一个新镜像层添加到镜像当中。</p>
<p>Docker通过存储引擎(新版本采用快照机制)的方式来实现镜像层堆栈,并保证多镜像层对外展示为统一的文件系统。</p>
<p>Linux.上可用的存储引擎有AUFS、Overlay2、 Device Mapper、Btrfs 以及ZFS。顾名思义,每种存储引擎都基于Linux中对应的文件系统或者块设备技术,并且每种存储引擎都有其独有的性能特点。</p>
<p>Docker在Windows上仅支持windowsfilter一种存储引擎,该引擎基于NTFS文件系统之上实现了分层和CoW[1]。</p>
<p>下图展示了与系统显示相同的三层镜像。所有镜像层堆叠并合并,对外提供统一的视图。</p>
<p><img alt="image-20200621164200743" data-src="http://yhaq.top/group1/M00/00/00/rBGWVV7zdb6AHMMvAADaF9m9sUI864.png" class="lazyload"></p>
<p><strong>特点</strong></p>
<p>Docker镜像都是只读的,当容器启动时, 一个新的可写层被加载到镜像的顶部!<br>这一层就是我们通常说的容器层,容器之下的都叫镜像层!</p>
<p><img alt="image-20200621164335531" data-src="http://yhaq.top/group1/M00/00/00/rBGWVV7zdiGASClOAADQ3gcwzhA134.png" class="lazyload"></p>
<h2 id="commit镜像"><a href="#commit镜像" class="headerlink" title="commit镜像"></a>commit镜像</h2><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">docker commit 提交容器成为一个新的副本</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 命令和git原理类似</span></span><br><span class="line">docker commit -m="新的描述信息" -a="作者" 容器id 目标镜像名:[TAG]</span><br></pre></td></tr></tbody></table></figure>

<p>测试</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 新建一个tomcat 并且添加自己的配置</span></span><br></pre></td></tr></tbody></table></figure>



<p><img alt="image-20200621133922978" data-src="http://yhaq.top/group1/M00/00/00/rBGWVV7zdiGAcUiEAAClceMrCCQ391.png" class="lazyload"></p>
<h1 id="容器数据卷"><a href="#容器数据卷" class="headerlink" title="容器数据卷"></a>容器数据卷</h1><h2 id="什么是容器数据卷"><a href="#什么是容器数据卷" class="headerlink" title="什么是容器数据卷"></a>什么是容器数据卷</h2><p>如果数据都在容器中，那么我么容器删除，数据就会丢失！</p>
<p>需求：数据可以持节化</p>
<p>需求：数据可以储存在本地</p>
<p>容器之间可以有一个数据共享的技术! Docker 容器中产生的数据,同步到本地!</p>
<p>这就是卷技术!目录的挂载,将我们容器内的目录,挂载到Linux上面!</p>
<p><img alt="image-20200621134828333" data-src="http://yhaq.top/group1/M00/00/00/rBGWVV7zdiGAelFXAADQK8QcOU0531.png" class="lazyload"></p>
<p><strong>总结一句话:容器的持久化和同步操作!容器间也是可以数据共享的!</strong></p>
<h2 id="使用数据卷"><a href="#使用数据卷" class="headerlink" title="使用数据卷"></a>使用数据卷</h2><p>方式一：直接使用命令-v来启动</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker run -it -v /home/ceshi:/home centos</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 使用docket inspect查看卷信息</span></span><br></pre></td></tr></tbody></table></figure>



<p><img alt="image-20200621163307788" data-src="C:%5CUsers%5C%E4%BA%8E%E6%B5%A9%E5%BC%BA%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20200621163307788.png" class="lazyload"></p>
<p><strong>测试</strong></p>
<p>linux中</p>
<p><img alt="image-20200621165909399" data-src="http://yhaq.top/group1/M00/00/00/rBGWVV7zd7qAIVfmAABK-pPJUUw424.png" class="lazyload"></p>
<p>查看容器中</p>
<p><img alt="image-20200621165931018" data-src="http://yhaq.top/group1/M00/00/00/rBGWVV7zd7qASlPNAAAj92c-zR0972.png" class="lazyload"></p>
<p>可以看到已经同步过来了</p>
<blockquote>
<p>停止容器之后也可以修改其中的文件，容器再次启动之后可以看到同步的文件</p>
</blockquote>
<h2 id="mysql安装以及数据同步"><a href="#mysql安装以及数据同步" class="headerlink" title="mysql安装以及数据同步"></a>mysql安装以及数据同步</h2><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 启动mysql</span></span><br><span class="line">docker run -d -p 39011:3306 -v /home/mysql/conf:/etc/mysql/conf.d -v /home/mysql/data:/var/lib/mysql -e MYSQL_ROOT_PASSWORD=123456 --name mysql01 mysql:5.7</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> mysql 需要设置密码</span></span><br></pre></td></tr></tbody></table></figure>

<p>使用远程终端登录mysql创建一个库</p>
<p><img alt="image-20200621171654986" data-src="http://yhaq.top/group1/M00/00/00/rBGWVV7zd7qAIGlrAAAbHW-Rl_0536.png" class="lazyload"></p>
<p>这是查看linux中的/home/mysql/data目录下面已经同步了数据</p>
<p><img alt="image-20200621171627801" data-src="http://yhaq.top/group1/M00/00/00/rBGWVV7zd7qAAgiAAABKID20hjs014.png" class="lazyload"></p>
<p>这是强制删除mysql</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@iz2zege5xssb2avm6if6l8z ~]# docker rm -f 02b2bd65bbcd</span><br><span class="line">02b2bd65bbcd</span><br><span class="line">[root@iz2zege5xssb2avm6if6l8z ~]# </span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 然后再次查看/home/mysql/data下面是否有数据</span></span><br><span class="line">可以看到数据仍然存在</span><br></pre></td></tr></tbody></table></figure>



<h2 id="具名挂载和匿名挂载"><a href="#具名挂载和匿名挂载" class="headerlink" title="具名挂载和匿名挂载"></a>具名挂载和匿名挂载</h2><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 匿名挂载</span></span><br><span class="line">-v 容器内路径！</span><br><span class="line">docker run -d -p --name nginx01 -v /etc/nginx nginx</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看所有的volume情况</span></span><br><span class="line">[root@iz2zege5xssb2avm6if6l8z data]# docker volume ls</span><br><span class="line">DRIVER              VOLUME NAME</span><br><span class="line">local               db8db0f154b2ca6cc45f8619f8bff257bf59623e44c487564d809cb4f1cdd5e2</span><br><span class="line">[root@iz2zege5xssb2avm6if6l8z data]# </span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 这里发现，这种就是匿名挂载，我们在-V只写了容器内的路径，没有写容器外的路径!</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 具名挂载</span></span><br><span class="line">docker run -d -p --name nginx01 -v juming:/etc/nginx nginx</span><br><span class="line"></span><br><span class="line">[root@iz2zege5xssb2avm6if6l8z data]# docker volume ls</span><br><span class="line">local               juming</span><br><span class="line"></span><br><span class="line">[root@iz2zege5xssb2avm6if6l8z data]# docker volume inspect db8db0f154b2ca6cc45f8619f8bff257bf59623e44c487564d809cb4f1cdd5e2</span><br><span class="line">[</span><br><span class="line">    {</span><br><span class="line">        "CreatedAt": "2020-06-21T11:50:31+08:00",</span><br><span class="line">        "Driver": "local",</span><br><span class="line">        "Labels": null,</span><br><span class="line">        "Mountpoint": "/var/lib/docker/volumes/db8db0f154b2ca6cc45f8619f8bff257bf59623e44c487564d809cb4f1cdd5e2/_data",</span><br><span class="line">        "Name": "db8db0f154b2ca6cc45f8619f8bff257bf59623e44c487564d809cb4f1cdd5e2",</span><br><span class="line">        "Options": null,</span><br><span class="line">        "Scope": "local"</span><br><span class="line">    }</span><br><span class="line">]</span><br></pre></td></tr></tbody></table></figure>

<p>所有docker容器内的卷，没有指定目录的情况下都是/var/lib/docker/volumes/XXX/_data</p>
<p>具名挂载方便我们找到一个卷，大多情况都是使用具名挂载</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">-v 容器内路径 # 匿名挂载</span><br><span class="line">-v 卷名:容器内路径 # 具名挂载</span><br><span class="line">-v /宿主机路径:容器内路径 # 指定路径挂载</span><br></pre></td></tr></tbody></table></figure>

<p><strong>拓展</strong></p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 通过-v 容器内路径:ro   rw 来改变读写权限</span></span><br><span class="line">ro readonly</span><br><span class="line">rw readwrite </span><br><span class="line"><span class="meta">#</span><span class="bash">一旦这个了设置了容器权限，容器对我们挂载出来的内容就有限定了!</span></span><br><span class="line">docker run -d -p --name nginx01 -v /etc/nginx:ro nginx</span><br><span class="line">docker run -d -p --name nginx01 -v /etc/nginx:rw nginx</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 只要看到ro就说明只能通过宿主机来操作，容器内无法进行更改</span></span><br></pre></td></tr></tbody></table></figure>



<h2 id="初识DockerFile"><a href="#初识DockerFile" class="headerlink" title="初识DockerFile"></a>初识DockerFile</h2><p>Dockerfile就是用来构建docker镜像的构建文件!命令脚本!先体验一下!</p>
<p>首先创建一个dockerfile文件</p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">FROM centos</span><br><span class="line">VOLUME ["volume01","volume01"]</span><br><span class="line"></span><br><span class="line">CMD echo "---end---"</span><br><span class="line">CMD /bin/bash</span><br><span class="line">~</span><br></pre></td></tr></tbody></table></figure>



<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">-f dockerfile的位置  -t 镜像名</span><br><span class="line">[root@iz2zege5xssb2avm6if6l8z docker_test_volume]# docker build -f /home/docker_test_volume/dockerfile1 -t yhq/centos:1.0 .</span><br><span class="line">Sending build context to Docker daemon  2.048kB</span><br><span class="line">Step 1/4 : FROM centos</span><br><span class="line"><span class="meta"> ---></span><span class="bash"> 831691599b88</span></span><br><span class="line">Step 2/4 : VOLUME ["volume01","volume01"]</span><br><span class="line"><span class="meta"> ---></span><span class="bash"> Running <span class="keyword">in</span> a92d80908c5c</span></span><br><span class="line">Removing intermediate container a92d80908c5c</span><br><span class="line"><span class="meta"> ---></span><span class="bash"> 82c7e3e4cf4e</span></span><br><span class="line">Step 3/4 : CMD echo "---end---"</span><br><span class="line"><span class="meta"> ---></span><span class="bash"> Running <span class="keyword">in</span> a761e2ca4661</span></span><br><span class="line">Removing intermediate container a761e2ca4661</span><br><span class="line"><span class="meta"> ---></span><span class="bash"> 46c27e1c11e7</span></span><br><span class="line">Step 4/4 : CMD /bin/bash</span><br><span class="line"><span class="meta"> ---></span><span class="bash"> Running <span class="keyword">in</span> 8c3b6828c60d</span></span><br><span class="line">Removing intermediate container 8c3b6828c60d</span><br><span class="line"><span class="meta"> ---></span><span class="bash"> 0a9fabb9ff60</span></span><br><span class="line">Successfully built 0a9fabb9ff60</span><br><span class="line">Successfully tagged yhq/centos:1.0</span><br></pre></td></tr></tbody></table></figure>

<p><img alt="image-20200621174950397" data-src="http://yhaq.top/group1/M00/00/00/rBGWVV7zd7qACTMJAAB31KA60ow945.png" class="lazyload"></p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 启动自己的镜像</span></span><br><span class="line">docker run -it ab384672c766 /bin/bash</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 可以看到存在两个之前设设置好的volume01 02 说明宿主机中有自动挂载好的目录</span></span><br></pre></td></tr></tbody></table></figure>



<p><img alt="image-20200621175654738" data-src="http://yhaq.top/group1/M00/00/00/rBGWVV7zd7qAHaViAABLJ15mNn8444.png" class="lazyload"></p>
<p>使用docker inspect 查看 可以看到宿主机的源目录</p>
<figure class="highlight"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">"Mounts": [</span><br><span class="line">           {</span><br><span class="line">               <span class="attr">"Type"</span>: <span class="string">"volume"</span>,</span><br><span class="line">               <span class="attr">"Name"</span>: <span class="string">"07e79d001f1e5b9380b69ebcd5afd4df9f1b3a021abed38744c8c62e837364b4"</span>,</span><br><span class="line">               <span class="attr">"Source"</span>: <span class="string">"/var/lib/docker/volumes/07e79d001f1e5b9380b69ebcd5afd4df9f1b3a021abed38744c8c62e837364b4/_data"</span>,</span><br><span class="line">               <span class="attr">"Destination"</span>: <span class="string">"volume01"</span>,</span><br><span class="line">               <span class="attr">"Driver"</span>: <span class="string">"local"</span>,</span><br><span class="line">               <span class="attr">"Mode"</span>: <span class="string">""</span>,</span><br><span class="line">               <span class="attr">"RW"</span>: <span class="literal">true</span>,</span><br><span class="line">               <span class="attr">"Propagation"</span>: <span class="string">""</span></span><br><span class="line">           },</span><br><span class="line">           {</span><br><span class="line">               <span class="attr">"Type"</span>: <span class="string">"volume"</span>,</span><br><span class="line">               <span class="attr">"Name"</span>: <span class="string">"57cbe07c4b3a799c199c8f28defbb513d6da18a7667f719748064482646e3bcf"</span>,</span><br><span class="line">               <span class="attr">"Source"</span>: <span class="string">"/var/lib/docker/volumes/57cbe07c4b3a799c199c8f28defbb513d6da18a7667f719748064482646e3bcf/_data"</span>,</span><br><span class="line">               <span class="attr">"Destination"</span>: <span class="string">"volume02"</span>,</span><br><span class="line">               <span class="attr">"Driver"</span>: <span class="string">"local"</span>,</span><br><span class="line">               <span class="attr">"Mode"</span>: <span class="string">""</span>,</span><br><span class="line">               <span class="attr">"RW"</span>: <span class="literal">true</span>,</span><br><span class="line">               <span class="attr">"Propagation"</span>: <span class="string">""</span></span><br><span class="line">           }</span><br><span class="line">       ],</span><br></pre></td></tr></tbody></table></figure>

<h2 id="数据卷容器"><a href="#数据卷容器" class="headerlink" title="数据卷容器"></a>数据卷容器</h2><p>命令mysql同步数据！</p>
<p><img alt="image-20200622111210873" data-src="http://yhaq.top/group1/M00/00/00/rBGWVV7zd7qAfJPzAADP_oLZdRQ834.png" class="lazyload"></p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">[root@iz2zege5xssb2avm6if6l8z ~]# docker run -it --name docker01 yhq/centos:1.0 /bin/bash</span><br><span class="line"></span><br><span class="line">[root@ff0cac96446b /]# ls -l</span><br><span class="line">total 56</span><br><span class="line">drwxr-xr-x   2 root root 4096 Jun 22 03:19 volume01</span><br><span class="line">drwxr-xr-x   2 root root 4096 Jun 22 03:19 volume02</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@iz2zege5xssb2avm6if6l8z ~]# docker ps</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND             CREATED              STATUS              PORTS                     NAMES</span><br><span class="line">ff0cac96446b        yhq/centos:1.0      "/bin/bash"         About a minute ago   Up About a minute                             docker01</span><br><span class="line">3b27be139d04        tomcat              "catalina.sh run"   24 hours ago         Up 22 hours         0.0.0.0:39008->8080/tcp   tomcat01</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 新建第二个容器，并且挂载第一个容器</span></span><br><span class="line">[root@iz2zege5xssb2avm6if6l8z ~]# docker run -it --name docker02 --volumes-from docker01 yhq/centos:1.0</span><br><span class="line">[root@220cf3b095bb /]# ls -l</span><br><span class="line">drwxr-xr-x   2 root root 4096 Jun 22 03:19 volume01</span><br><span class="line">drwxr-xr-x   2 root root 4096 Jun 22 03:19 volume02</span><br><span class="line">[root@220cf3b095bb /]# cd volume01</span><br><span class="line">[root@220cf3b095bb volume01]# ls</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 在第二个容器中新建一个文件</span></span><br><span class="line">[root@220cf3b095bb volume01]# touch testtestvolume</span><br><span class="line">[root@220cf3b095bb volume01]# ls</span><br><span class="line">testtestvolume</span><br><span class="line">[root@220cf3b095bb volume01]# [root@iz2zege5xssb2avm6if6l8z ~]# </span><br><span class="line">[root@iz2zege5xssb2avm6if6l8z ~]# docker ps</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                     NAMES</span><br><span class="line">220cf3b095bb        yhq/centos:1.0      "/bin/sh -c /bin/bash"   37 seconds ago      Up 37 seconds                                 docker02</span><br><span class="line">ff0cac96446b        yhq/centos:1.0      "/bin/bash"              2 minutes ago       Up 2 minutes                                  docker01</span><br><span class="line">3b27be139d04        tomcat              "catalina.sh run"        24 hours ago        Up 22 hours         0.0.0.0:39008->8080/tcp   tomcat01</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 进入第一个容器</span></span><br><span class="line">[root@iz2zege5xssb2avm6if6l8z ~]# docker exec -it 220cf3b095bb /bin/bash</span><br><span class="line">[root@220cf3b095bb /]# ls</span><br><span class="line">bin  dev  etc  home  lib  lib64  lost+found  media  mnt  opt  proc  root  run  sbin  srv  sys  tmp  usr  var  volume01  volume02</span><br><span class="line">[root@220cf3b095bb /]# cd volume01</span><br><span class="line">[root@220cf3b095bb volume01]# ls</span><br><span class="line">testtestvolume</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 给文件中写入数据</span></span><br><span class="line">[root@220cf3b095bb volume01]# ps > testtestvolume </span><br><span class="line">[root@220cf3b095bb volume01]# cat testtestvolume </span><br><span class="line">  PID TTY          TIME CMD</span><br><span class="line">   18 pts/1    00:00:00 bash</span><br><span class="line">   33 pts/1    00:00:00 ps</span><br><span class="line">   </span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看另一个容器中是否改变</span></span><br><span class="line">[root@iz2zege5xssb2avm6if6l8z ~]# docker exec -it ff0cac96446b /bin/bash</span><br><span class="line">[root@ff0cac96446b /]# cd volume01</span><br><span class="line">[root@ff0cac96446b volume01]# ls</span><br><span class="line">testtestvolume</span><br><span class="line">[root@ff0cac96446b volume01]# cat testtestvolume </span><br><span class="line">  PID TTY          TIME CMD</span><br><span class="line">   18 pts/1    00:00:00 bash</span><br><span class="line">   33 pts/1    00:00:00 ps</span><br><span class="line">[root@ff0cac96446b volume01]# </span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 新建一个docker03容器，也挂载01的数据， 可以看到数据仍然同步</span></span><br><span class="line">docker run -it --name docker03 --volumes-from docker01 yhq/centos:1.0</span><br></pre></td></tr></tbody></table></figure>



<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 如果删除容器一，其他两个容器的挂载文件仍然存在</span></span><br></pre></td></tr></tbody></table></figure>

<p><img alt="image-20200622113313951" data-src="http://yhaq.top/group1/M00/00/00/rBGWVV7zeEKAADIdAADahBnohXw383.png" class="lazyload"></p>
<p><strong>多个mysql实现数据共享</strong></p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 第一个docker 容器</span></span><br><span class="line">docker run -d -p 39011:3306 -v /etc/mysql/conf.d -v /var/lib/mysql -e MYSQL_ROOT_PASSWORD=123456 --name mysql01 mysql:5.7</span><br><span class="line"><span class="meta">#</span><span class="bash"> 第二个docker 容器</span></span><br><span class="line">docker run -d -p 39011:3306 -e MYSQL_ROOT_PASSWORD=123456 --name mysql02 --volumes-from mysql01 mysql:5.7</span><br></pre></td></tr></tbody></table></figure>

<p>容器之间配置信息的传递,数据卷容器的生命周期一直持续到没有容器使用为止。</p>
<h1 id="DockerFile"><a href="#DockerFile" class="headerlink" title="DockerFile"></a>DockerFile</h1><h2 id="dockerFile介绍"><a href="#dockerFile介绍" class="headerlink" title="dockerFile介绍"></a>dockerFile介绍</h2><p>docker是用来构建docker镜像的文件</p>
<p>构建步骤:</p>
<p>1、编写一个dockerfile 文件</p>
<p>2、docker build构建成为一个镜像</p>
<p>3、docker run运行镜像</p>
<p>4、docker push发布镜像( DockerHub、阿里云镜像仓库!)</p>
<p>查看一下官方镜像</p>
<p><img alt="image-20200622115424985" data-src="http://yhaq.top/group1/M00/00/00/rBGWVV7zeEKAMRZeAABtAJrVeVU163.png" class="lazyload"></p>
<h2 id="dockerFile构建过程"><a href="#dockerFile构建过程" class="headerlink" title="dockerFile构建过程"></a>dockerFile构建过程</h2><p><strong>基础：</strong></p>
<p>1、每个保留关键字（指令）都是大写字母</p>
<p>2、执行从上到下顺序执行</p>
<p>3、每一个指令都会创建提交一个新的镜像层</p>
<p><img alt="image-20200622120256044" data-src="http://yhaq.top/group1/M00/00/00/rBGWVV7zeEKACBF8AAH6aVMZFxs568.png" class="lazyload"></p>
<p>dockerfile是面向开发的，我们发布项目，做镜像，就需要编写dockerfile文件</p>
<p>dockerFile:构建文件，定义了一切的步骤，源代码</p>
<p>dockerImages：通过dockerFile构建生成的镜像，最终发布和运行产品</p>
<p>Docker容器：容器就是镜像运行起来提供服务</p>
<h2 id="DockerFile指令"><a href="#DockerFile指令" class="headerlink" title="DockerFile指令"></a>DockerFile指令</h2><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">FROM				# 基础镜像，一切从这里开始</span><br><span class="line">MAINTAINER			# 镜像是谁写的，姓名+邮箱</span><br><span class="line">RUN					# 镜像构建的时候需要运行的指令</span><br><span class="line">ADD 				# 步骤，tomcat镜像，这个tomcat压缩包！添加内容</span><br><span class="line">WORKDIR				# 镜像的工作目录</span><br><span class="line">VOLUME				# 挂载的目录</span><br><span class="line">EXPOSE				# 保留端口配置</span><br><span class="line">CMD					# 指定这个容器启动的时候要运行的命令，只有最后一个会生效，可以被替换</span><br><span class="line">ENTRYPOINT			# 指定这个容器启动的时候要运行的命令，可以追加命令</span><br><span class="line">ONBUILD				# 当构建一个被继承的DockerFile，这个时候就会运行ONBUILD</span><br><span class="line">COPY				# 类似ADD，将我们文件拷贝到镜像中</span><br><span class="line">ENV					# 构建的时候设置环境变量</span><br></pre></td></tr></tbody></table></figure>

<p><img alt="image-20200622134317127" data-src="http://yhaq.top/group1/M00/00/00/rBGWVV7zeEKADv9AAAXnckyOKl0327.png" class="lazyload"></p>
<h2 id="实战测试"><a href="#实战测试" class="headerlink" title="实战测试"></a>实战测试</h2><p>Docker Hub中99%镜像都是从这个基础镜像开始的 FROM scratch，然后配置需要的软件和配置来完成构建</p>
<blockquote>
<p>创建一个自己的centos</p>
</blockquote>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 1.编写dockerFile文件</span></span><br><span class="line">[root@iz2zege5xssb2avm6if6l8z docker_test_volume]# cat myDockerFile-centos </span><br><span class="line">FROM centos</span><br><span class="line">MAINTAINER YHQ<test@test.com></span><br><span class="line"></span><br><span class="line">ENV MYPATH /usr/local</span><br><span class="line">WORKDIR $MYPATH</span><br><span class="line"></span><br><span class="line">RUN yum -y install vim</span><br><span class="line">RUN yum -y install net-tools</span><br><span class="line"></span><br><span class="line">EXPOSE 80</span><br><span class="line"></span><br><span class="line">CMD echo $MYPATH</span><br><span class="line">CMD echo "-----END-----"</span><br><span class="line">CMD /bin/bash</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 2.通过这个文件构建镜像</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> docker build -f dockerfile文件路径 -t 镜像名:tag</span></span><br><span class="line">[root@iz2zege5xssb2avm6if6l8z docker_test_volume]# docker build -f ./myDockerFile-centos -t mycentos:0.1 .</span><br><span class="line">Sending build context to Docker daemon  3.072kB</span><br><span class="line">Step 1/10 : FROM centos</span><br><span class="line"><span class="meta"> ---></span><span class="bash"> 831691599b88</span></span><br><span class="line">Step 2/10 : MAINTAINER YHQ<test@test.com></span><br><span class="line"><span class="meta"> ---></span><span class="bash"> Running <span class="keyword">in</span> c1cb762dc186</span></span><br><span class="line">Removing intermediate container c1cb762dc186</span><br><span class="line"><span class="meta"> ---></span><span class="bash"> af3f14c058c2</span></span><br><span class="line">Step 3/10 : ENV MYPATH /usr/local</span><br><span class="line"><span class="meta"> ---></span><span class="bash"> Running <span class="keyword">in</span> 6da66bfc72c0</span></span><br><span class="line">Removing intermediate container 6da66bfc72c0</span><br><span class="line"><span class="meta"> ---></span><span class="bash"> 62960cb68ab2</span></span><br><span class="line">Step 4/10 : WORKDIR $MYPATH</span><br><span class="line"><span class="meta"> ---></span><span class="bash"> Running <span class="keyword">in</span> c45a58556c1a</span></span><br><span class="line">Removing intermediate container c45a58556c1a</span><br><span class="line"><span class="meta"> ---></span><span class="bash"> f9f7d781cd72</span></span><br><span class="line">Step 5/10 : RUN yum -y install vim</span><br><span class="line"><span class="meta"> ---></span><span class="bash"> Running <span class="keyword">in</span> fdfa16efeb95</span></span><br><span class="line"></span><br><span class="line">Step 6/10 : RUN yum -y install net-tools</span><br><span class="line"><span class="meta"> ---></span><span class="bash"> Running <span class="keyword">in</span> 7624ab166b7b</span></span><br><span class="line"></span><br><span class="line">Removing intermediate container 7624ab166b7b</span><br><span class="line"><span class="meta"> ---></span><span class="bash"> 74941d9ccb61</span></span><br><span class="line">Step 7/10 : EXPOSE 80</span><br><span class="line"><span class="meta"> ---></span><span class="bash"> Running <span class="keyword">in</span> 8dd8dbfad0dc</span></span><br><span class="line">Removing intermediate container 8dd8dbfad0dc</span><br><span class="line"><span class="meta"> ---></span><span class="bash"> 1e08e91605d8</span></span><br><span class="line">Step 8/10 : CMD echo $MYPATH</span><br><span class="line"><span class="meta"> ---></span><span class="bash"> Running <span class="keyword">in</span> a56d7dc98890</span></span><br><span class="line">Removing intermediate container a56d7dc98890</span><br><span class="line"><span class="meta"> ---></span><span class="bash"> 27ee36956505</span></span><br><span class="line">Step 9/10 : CMD echo "-----END-----"</span><br><span class="line"><span class="meta"> ---></span><span class="bash"> Running <span class="keyword">in</span> 1c7139c18ec8</span></span><br><span class="line">Removing intermediate container 1c7139c18ec8</span><br><span class="line"><span class="meta"> ---></span><span class="bash"> 3ff0bc4b5826</span></span><br><span class="line">Step 10/10 : CMD /bin/bash</span><br><span class="line"><span class="meta"> ---></span><span class="bash"> Running <span class="keyword">in</span> 36a87a0d5e79</span></span><br><span class="line">Removing intermediate container 36a87a0d5e79</span><br><span class="line"><span class="meta"> ---></span><span class="bash"> d3e72a304f7a</span></span><br><span class="line">Successfully built d3e72a304f7a</span><br><span class="line">Successfully tagged mycentos:0.1</span><br></pre></td></tr></tbody></table></figure>

<p>对比官方centos</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">[root@iz2zege5xssb2avm6if6l8z docker_test_volume]# docker run -it mycentos:0.1</span><br><span class="line">[root@47ca3db3e5c3 local]# pwd</span><br><span class="line">/usr/local</span><br><span class="line">[root@47ca3db3e5c3 local]# ifconfig</span><br><span class="line">eth0: flags=4163<UP,BROADCAST,RUNNING,MULTICAST>  mtu 1500</span><br><span class="line">        inet 172.18.0.3  netmask 255.255.0.0  broadcast 172.18.255.255</span><br><span class="line"></span><br><span class="line">[root@47ca3db3e5c3 local]# vim 123</span><br><span class="line">[root@47ca3db3e5c3 local]# </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 官方</span></span><br><span class="line">[root@iz2zege5xssb2avm6if6l8z ~]# docker run  -it centos</span><br><span class="line">[root@b021eb365c5a /]# pwd</span><br><span class="line">/</span><br><span class="line">[root@b021eb365c5a /]# vim 123</span><br><span class="line">bash: vim: command not found</span><br><span class="line">[root@b021eb365c5a /]# ifconfig</span><br><span class="line">bash: ifconfig: command not found</span><br><span class="line">[root@b021eb365c5a /]#</span><br></pre></td></tr></tbody></table></figure>

<p>docker history 镜像id    # 查看变更历史</p>
<p><img alt="image-20200622141149490" data-src="http://yhaq.top/group1/M00/00/00/rBGWVV7zeEKAfjpkAAC-gahyvR0683.png" class="lazyload"></p>
<p><strong>CMD 和 ENTRYPOINT的区别</strong></p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">CMD					# 指定这个容器启动的时候要运行的命令，只有最后一个会生效，可以被替换</span><br><span class="line">ENTRYPOINT			# 指定这个容器启动的时候要运行的命令，可以追加命令</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 编写dockerfile文件</span></span><br><span class="line">FROM centos</span><br><span class="line">CMD ["ls","-a"]</span><br><span class="line"></span><br><span class="line">[root@iz2zege5xssb2avm6if6l8z DockerFile]# docker build -f docker_cmd_test -t cmdtest .</span><br><span class="line">Sending build context to Docker daemon  3.072kB</span><br><span class="line">Step 1/2 : FROM centos</span><br><span class="line"><span class="meta"> ---></span><span class="bash"> 831691599b88</span></span><br><span class="line">Step 2/2 : CMD ["ls","-a"]</span><br><span class="line"><span class="meta"> ---></span><span class="bash"> Running <span class="keyword">in</span> 5d44bb2a5649</span></span><br><span class="line">Removing intermediate container 5d44bb2a5649</span><br><span class="line"><span class="meta"> ---></span><span class="bash"> 540870fe127a</span></span><br><span class="line">Successfully built 540870fe127a</span><br><span class="line">Successfully tagged cmdtest:latest</span><br><span class="line">[root@iz2zege5xssb2avm6if6l8z DockerFile]# docker run 540870fe127a</span><br><span class="line">.</span><br><span class="line">..</span><br><span class="line">.dockerenv</span><br><span class="line">bin</span><br><span class="line">dev</span><br><span class="line">etc</span><br><span class="line">[root@iz2zege5xssb2avm6if6l8z DockerFile]# docker run 540870fe127a -l</span><br><span class="line">docker: Error response from daemon: OCI runtime create failed: container_linux.go:349: starting container process caused "exec: \"-l\": executable file not found in $PATH": unknown.</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 这样会报错，因为-l会替换掉 ls -a 这样就无法找到-l命令</span></span><br></pre></td></tr></tbody></table></figure>

<p>ENTRYPOINT</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">[root@iz2zege5xssb2avm6if6l8z DockerFile]# docker build -f ./docker_cmd_entrypoint -t entrypointtest .</span><br><span class="line">Sending build context to Docker daemon  4.096kB</span><br><span class="line">Step 1/2 : FROM centos</span><br><span class="line"><span class="meta"> ---></span><span class="bash"> 831691599b88</span></span><br><span class="line">Step 2/2 : ENTRYPOINT ["ls","-a"]</span><br><span class="line"><span class="meta"> ---></span><span class="bash"> Running <span class="keyword">in</span> 0aff089725a5</span></span><br><span class="line">Removing intermediate container 0aff089725a5</span><br><span class="line"><span class="meta"> ---></span><span class="bash"> b9986bd7c03b</span></span><br><span class="line">Successfully built b9986bd7c03b</span><br><span class="line">Successfully tagged entrypointtest:latest</span><br><span class="line"></span><br><span class="line">[root@iz2zege5xssb2avm6if6l8z DockerFile]# docker run b9986bd7c03b -l</span><br><span class="line">total 56</span><br><span class="line">drwxr-xr-x   1 root root 4096 Jun 22 08:25 .</span><br><span class="line">drwxr-xr-x   1 root root 4096 Jun 22 08:25 ..</span><br><span class="line">-rwxr-xr-x   1 root root    0 Jun 22 08:25 .dockerenv</span><br><span class="line">lrwxrwxrwx   1 root root    7 May 11  2019 bin -> usr/bin</span><br><span class="line">drwxr-xr-x   5 root root  340 Jun 22 08:25 dev</span><br><span class="line">drwxr-xr-x   1 root root 4096 Jun 22 08:25 etc</span><br><span class="line">drwxr-xr-x   2 root root 4096 May 11  2019 home</span><br><span class="line">lrwxrwxrwx   1 root root    7 May 11  2019 lib -> usr/lib</span><br><span class="line">lrwxrwxrwx   1 root root    9 May 11  2019 lib64 -> usr/lib64</span><br></pre></td></tr></tbody></table></figure>

<h2 id="实战：tomcat镜像"><a href="#实战：tomcat镜像" class="headerlink" title="实战：tomcat镜像"></a>实战：tomcat镜像</h2><p>1、准备tomcat、jdk安装包</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@iz2zege5xssb2avm6if6l8z DiyTomcat]# ls</span><br><span class="line">apache-tomcat-9.0.36.tar.gz  jdk-linux-x64.tar.gz</span><br><span class="line">[root@iz2zege5xssb2avm6if6l8z DiyTomcat]#</span><br></pre></td></tr></tbody></table></figure>

<p>2、编写Dockerfile文件，文件名使用Dockerfile，会自动找到</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">FROM centos</span><br><span class="line">MAINTAINER yhq</span><br><span class="line"></span><br><span class="line">ADD jdk-linux-x64.tar.gz /usr/local/</span><br><span class="line">ADD apache-tomcat-9.0.36.tar.gz /usr/local/</span><br><span class="line"></span><br><span class="line">RUN yum -y install vim</span><br><span class="line"></span><br><span class="line">ENV MYPATH /usr/local</span><br><span class="line">WORKDIR $MYPATH</span><br><span class="line"></span><br><span class="line">ENV JAVA_HOME /usr/local/jdk1.8.0_131</span><br><span class="line">ENV CLASSPATH $JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jar</span><br><span class="line">ENV CATALINA_HOME /usr/local/apache-tomcat-9.0.36</span><br><span class="line">ENV CATALINA_BASH /usr/local/apache-tomcat-9.0.36</span><br><span class="line">ENV PATH $PATH:$JAVA_HOME/bin:$CATALINA_HOME/lib:$CATALINA_HOME/bin</span><br><span class="line"></span><br><span class="line">EXPOSE 8080</span><br><span class="line"></span><br><span class="line">CMD /usr/local/apache-tomcat-9.0.36/bin/startup.sh && tail -F /usr/local/apache-tomcat-9.0.36/bin/logs/catalina.out</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@iz2zege5xssb2avm6if6l8z DiyTomcat]# docker build -t yhqtomcat .</span><br></pre></td></tr></tbody></table></figure>

<p>3、启动yhqtomcat</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@iz2zege5xssb2avm6if6l8z DiyTomcat]# docker run -d -p 39111:8080 --name yhqtomcat01 -v /home/yhq/build/tomcat/test:/usr/local/apache-tomcat-9.0.36/webapps/test -v /home/yhq/build/tomcat/tomcatlogs:/usr/local/apache-tomcat-9.0.36/logs yhqtomcat</span><br><span class="line"></span><br><span class="line">使用curl localhost:39111 验证是否成功</span><br></pre></td></tr></tbody></table></figure>

<p>4、在挂载的目录上新建一个tomcat项目</p>
<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">mkdir WEB-INF</span><br><span class="line">cd WEB-INF</span><br><span class="line">vim web.xml</span><br><span class="line"></span><br><span class="line"><span class="meta"><?xml version="1.0" encoding="UTF-8"?></span></span><br><span class="line"><span class="tag"><<span class="name">web-app</span> <span class="attr">xmlns</span>=<span class="string">"http://xmlns.jcp.org/xml/ns/javaee"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_4_0.xsd"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">version</span>=<span class="string">"4.0"</span>></span></span><br><span class="line">    </span><br><span class="line"><span class="tag"></<span class="name">web-app</span>></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">index.jsp</span><br><span class="line">[root@iz2zege5xssb2avm6if6l8z test]# cat index.jsp </span><br><span class="line"><span class="tag"><<span class="name">%@</span> <span class="attr">page</span> <span class="attr">language</span>=<span class="string">"java"</span> <span class="attr">contentType</span>=<span class="string">"text/html; charset=UTF-8"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">pageEncoding</span>=<span class="string">"UTF-8"</span>%></span></span><br><span class="line"><span class="tag"><<span class="name">html</span>></span></span><br><span class="line">    <span class="tag"><<span class="name">head</span>></span></span><br><span class="line">           <span class="tag"><<span class="name">title</span>></span>hello<span class="tag"></<span class="name">title</span>></span></span><br><span class="line">    <span class="tag"></<span class="name">head</span>></span></span><br><span class="line">    <span class="tag"><<span class="name">body</span>></span></span><br><span class="line"><span class="tag"><<span class="name">h1</span>></span>hello world！<span class="tag"></<span class="name">h1</span>></span></span><br><span class="line">           <span class="tag"><<span class="name">%</span></span></span><br><span class="line"><span class="tag">                 <span class="attr">System.</span> <span class="attr">out.println</span>("<span class="attr">Hello</span> <span class="attr">World</span>！");</span></span><br><span class="line"><span class="tag">           %></span></span><br><span class="line">              <span class="tag"></<span class="name">body</span>></span></span><br><span class="line">               <span class="tag"></<span class="name">html</span>></span></span><br></pre></td></tr></tbody></table></figure>

<h2 id="发布自己的镜像"><a href="#发布自己的镜像" class="headerlink" title="发布自己的镜像"></a>发布自己的镜像</h2><p><strong>dockerhub</strong></p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker push 镜像名</span><br></pre></td></tr></tbody></table></figure>

<p>速度慢，</p>
<p><strong>发布到阿里云</strong></p>
<p>1、登录阿里云</p>
<p>2、找到容器服务</p>
<p>3、创建命名空间</p>
<p><img alt="image-20200622175312704" data-src="http://yhaq.top/group1/M00/00/00/rBGWVV7zeEKAMD0qAAA3kj8gc5I972.png" class="lazyload"></p>
<p>4、创建容器镜像</p>
<p><img alt="image-20200622180719199" data-src="http://yhaq.top/group1/M00/00/00/rBGWVV7zeLmAQeteAACJ0NOHc8k250.png" class="lazyload"></p>
<p>5、进入仓库有具体的发布和拉去的步骤</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@iz2zege5xssb2avm6if6l8z test]# docker login --username=915540781@qq.com registry.cn-hangzhou.aliyuncs.com</span><br><span class="line">Password: </span><br><span class="line">WARNING! Your password will be stored unencrypted in /root/.docker/config.json.</span><br><span class="line">Configure a credential helper to remove this warning. See</span><br><span class="line">https://docs.docker.com/engine/reference/commandline/login/#credentials-store</span><br><span class="line"></span><br><span class="line">Login Succeeded</span><br></pre></td></tr></tbody></table></figure>



<h2 id="小结-1"><a href="#小结-1" class="headerlink" title="小结"></a>小结</h2><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker镜像可以从tar中load， 也可以save成一个tar文件</span><br></pre></td></tr></tbody></table></figure>





<p><img alt="image-20200622180701375" data-src="http://yhaq.top/group1/M00/00/00/rBGWVV7zeLmAMTiNAAN1wYuK0dk102.png" class="lazyload"></p>
<h1 id="Docker网络"><a href="#Docker网络" class="headerlink" title="Docker网络"></a>Docker网络</h1><h2 id="理解docker0"><a href="#理解docker0" class="headerlink" title="理解docker0"></a>理解docker0</h2><p><img alt="image-20200623142213095" data-src="http://yhaq.top/group1/M00/00/00/rBGWVV7zeLqAU0PZAARkWsogbI4456.png" class="lazyload"></p>
<p>三个网络</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 问题，docker是如何处理容器网络访问的</span></span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 查看容器内部网络地址</span></span><br><span class="line">[root@iz2zege5xssb2avm6if6l8z ~]# docker exec -it yhqtomcat01 ip addr</span><br><span class="line">1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1</span><br><span class="line">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">    inet 127.0.0.1/8 scope host lo</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">58: eth0@if59: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP group default </span><br><span class="line">    link/ether 02:42:ac:12:00:02 brd ff:ff:ff:ff:ff:ff link-netnsid 0</span><br><span class="line">    inet 172.18.0.2/16 brd 172.18.255.255 scope global eth0</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">       </span><br><span class="line"><span class="meta">#</span><span class="bash"> linux可以ping 内部容器</span></span><br><span class="line">[root@iz2zege5xssb2avm6if6l8z ~]# ping 172.18.0.2</span><br><span class="line">PING 172.18.0.2 (172.18.0.2) 56(84) bytes of data.</span><br><span class="line">64 bytes from 172.18.0.2: icmp_seq=1 ttl=64 time=0.077 ms</span><br><span class="line">64 bytes from 172.18.0.2: icmp_seq=2 ttl=64 time=0.046 ms</span><br><span class="line">64 bytes from 172.18.0.2: icmp_seq=3 ttl=64 time=0.065 ms</span><br><span class="line"></span><br><span class="line">--- 172.18.0.2 ping statistics ---</span><br><span class="line">6 packets transmitted, 6 received, 0% packet loss, time 5000ms</span><br><span class="line">rtt min/avg/max/mdev = 0.046/0.062/0.077/0.012 ms</span><br><span class="line"><span class="meta">#</span><span class="bash"> 可以ping通</span></span><br></pre></td></tr></tbody></table></figure>

<p><strong>原理</strong></p>
<p>1、我们每启动一个docker容器, docker就会给docker容器分配一个ip ,我们只要安装了docker , 就会有一个网卡 docker0</p>
<p>桥接模式,使用的技术是evth-pair技术!</p>
<p>再次测试linux ip addr<img alt="image-20200623143328018" data-src="http://yhaq.top/group1/M00/00/00/rBGWVV7zeLqAepwOAACfKxuegmk344.png" class="lazyload"></p>
<p>2、再启动一个容器测试，发先现多了一个</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 我们发现容器的网卡都是一对一对的</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> evth-pair 就是一对的虚拟设备接口，他们都是成对出现的，一段连着协议，一段彼此相连</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 正因为有了这个特性，evth-pair充当了一个桥梁</span></span><br></pre></td></tr></tbody></table></figure>

<p>3、测试tomcat01和tomca02是否可以ping通</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker exec -it tomcat02 ping 172.18.0.2</span><br></pre></td></tr></tbody></table></figure>

<p><img alt="image-20200623164248990" data-src="http://yhaq.top/group1/M00/00/00/rBGWVV7zeLqAeNaeAADTjC0-Hzk627.png" class="lazyload"></p>
<p>结论：tomcat01和tomcat02是公用的一个路由器，docker0</p>
<p>所有的容器不指定网络的情况下，都是docker0路由的，docker会给我们容器分配一个默认可用的ip</p>
<p><strong>小结</strong></p>
<p>docker使用的是linux的桥接，宿主机中是一个docker容器的网桥docker0.</p>
<p><img alt="image-20200623164753228" data-src="http://yhaq.top/group1/M00/00/00/rBGWVV7zeLqADAViAAD0RitAUAk581.png" class="lazyload"></p>
<p>Docker中的所有的网络接口都是虚拟的。虚拟的转发效率高！</p>
<blockquote>
<p>思考一个场景,我们编写了一个微服务，database url=ip:，项目不重启,数据库ip换掉了， 我们希望可以处理这个问题,可以名字来进行访问容器?</p>
</blockquote>
<h2 id="–link"><a href="#–link" class="headerlink" title="–link"></a>–link</h2><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 通过--link 连接</span></span><br><span class="line">[root@iz2zege5xssb2avm6if6l8z ~]# docker run -d --name yhqtomcat02 --link yhqtomcat01 yhqtomcat</span><br><span class="line">0650fe63c292f759458094933bf2139f2bc9a8fe2c14c6f27877e8f1a1ef6f60</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 通过名字可以直接ping通</span></span><br><span class="line">[root@iz2zege5xssb2avm6if6l8z ~]# docker exec -it yhqtomcat02 ping yhqtomcat01</span><br><span class="line">PING yhqtomcat01 (172.18.0.2) 56(84) bytes of data.</span><br><span class="line">64 bytes from yhqtomcat01 (172.18.0.2): icmp_seq=1 ttl=64 time=0.115 ms</span><br><span class="line">64 bytes from yhqtomcat01 (172.18.0.2): icmp_seq=2 ttl=64 time=0.053 ms</span><br><span class="line">64 bytes from yhqtomcat01 (172.18.0.2): icmp_seq=3 ttl=64 time=0.064 ms</span><br><span class="line">^C</span><br><span class="line">--- yhqtomcat01 ping statistics ---</span><br><span class="line">3 packets transmitted, 3 received, 0% packet loss, time 2ms</span><br><span class="line">rtt min/avg/max/mdev = 0.053/0.077/0.115/0.027 ms</span><br><span class="line">[root@iz2zege5xssb2avm6if6l8z ~]#</span><br></pre></td></tr></tbody></table></figure>

<p><strong>探究</strong></p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@iz2zege5xssb2avm6if6l8z ~]# docker network ls</span><br><span class="line">NETWORK ID          NAME                DRIVER              SCOPE</span><br><span class="line">f483d10c32be        bridge              bridge              local</span><br><span class="line">a3b709f8b13f        host                host                local</span><br><span class="line">c79127d1fc8f        none                null                local</span><br></pre></td></tr></tbody></table></figure>

<p><img alt="image-20200623170747038" data-src="http://yhaq.top/group1/M00/00/00/rBGWVV7zeLqAZyqTAABzAZ2-TFo502.png" class="lazyload"></p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 查看yhqtomcat02的hosts文件 ，可以发现 --link会自动将yhqtomcat01 写入一个映射</span></span><br><span class="line">[root@iz2zege5xssb2avm6if6l8z ~]# docker exec -it yhqtomcat02 cat /etc/hosts</span><br><span class="line">127.0.0.1       localhost</span><br><span class="line">::1     localhost ip6-localhost ip6-loopback</span><br><span class="line">fe00::0 ip6-localnet</span><br><span class="line">ff00::0 ip6-mcastprefix</span><br><span class="line">ff02::1 ip6-allnodes</span><br><span class="line">ff02::2 ip6-allrouters</span><br><span class="line">172.18.0.2      yhqtomcat01 60bd285237e8</span><br><span class="line">172.18.0.3      0650fe63c292</span><br><span class="line">[root@iz2zege5xssb2avm6if6l8z ~]#</span><br></pre></td></tr></tbody></table></figure>

<p>本质就是增加了一个hosts映射</p>
<h2 id="自定义网络"><a href="#自定义网络" class="headerlink" title="自定义网络"></a>自定义网络</h2><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@iz2zege5xssb2avm6if6l8z ~]# docker network ls</span><br><span class="line">NETWORK ID          NAME                DRIVER              SCOPE</span><br><span class="line">f483d10c32be        bridge              bridge              local</span><br><span class="line">a3b709f8b13f        host                host                local</span><br><span class="line">c79127d1fc8f        none                null                local</span><br><span class="line">[root@iz2zege5xssb2avm6if6l8z ~]#</span><br></pre></td></tr></tbody></table></figure>

<p><strong>网络模式</strong></p>
<p>1、bridge : 桥接docker (默认,自己床架也使用bridge模式)</p>
<p>2、none : 不配置网络</p>
<p>3、host :和宿主机共享网络</p>
<p>4、container :容器网络连通! (用的少!局限很大)</p>
<p><strong>测试</strong></p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 我们直接启动命令 --net bridge，而这个就是我们的docker0</span></span><br><span class="line">docker run -d -P --name tomcat01 tomcat</span><br><span class="line">docker run -d -P --name tomcat01 --net bridge tomcat</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> docker0特点，默认， 域名不能访问， --link可以打通连接</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 我们可以自定义一个网络</span></span><br><span class="line"></span><br><span class="line">[root@iz2zege5xssb2avm6if6l8z ~]# docker network create --driver bridge --subnet 192.168.0.0/16 --gateway 192.168.0.1 mynet</span><br><span class="line">337622e48719ca161f0d8204c44c9659bbbe08e22c81033d87cba63bb871e025</span><br><span class="line">[root@iz2zege5xssb2avm6if6l8z ~]# docker network ls</span><br><span class="line">NETWORK ID          NAME                DRIVER              SCOPE</span><br><span class="line">f483d10c32be        bridge              bridge              local</span><br><span class="line">a3b709f8b13f        host                host                local</span><br><span class="line">337622e48719        mynet               bridge              local</span><br><span class="line">c79127d1fc8f        none                null                local、</span><br></pre></td></tr></tbody></table></figure>

<p><img alt="image-20200623172838957" data-src="http://yhaq.top/group1/M00/00/00/rBGWVV7zeLqAItJkAABgvAEB90E864.png" class="lazyload"></p>
<p>使用自己的net启动两个tomcat</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker run -d -P --name tomcat-net-01 --net mynet tomcat</span><br><span class="line">docker run -d -P --name tomcat-net-02 --net mynet tomcat</span><br><span class="line">docker network inspect mynet</span><br></pre></td></tr></tbody></table></figure>

<p><img alt="image-20200623173032329" data-src="http://yhaq.top/group1/M00/00/00/rBGWVV7zeLqAQMEsAAB1_JJl4cE697.png" class="lazyload"></p>
<p>此时测试ping命令</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 直接ping ip</span></span><br><span class="line">[root@iz2zege5xssb2avm6if6l8z ~]# docker exec -it tomcat-net-01 ping 192.168.0.3</span><br><span class="line">PING 192.168.0.3 (192.168.0.3) 56(84) bytes of data.</span><br><span class="line">64 bytes from 192.168.0.3: icmp_seq=1 ttl=64 time=0.096 ms</span><br><span class="line">64 bytes from 192.168.0.3: icmp_seq=2 ttl=64 time=0.054 ms</span><br><span class="line">64 bytes from 192.168.0.3: icmp_seq=3 ttl=64 time=0.088 ms</span><br><span class="line">^C</span><br><span class="line">--- 192.168.0.3 ping statistics ---</span><br><span class="line">3 packets transmitted, 3 received, 0% packet loss, time 2ms</span><br><span class="line">rtt min/avg/max/mdev = 0.054/0.079/0.096/0.019 ms</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 直接ping容器名，这是不使用 --link也可以通</span></span><br><span class="line">[root@iz2zege5xssb2avm6if6l8z ~]# docker exec -it tomcat-net-01 ping tomcat-net-02</span><br><span class="line">PING tomcat-net-02 (192.168.0.3) 56(84) bytes of data.</span><br><span class="line">64 bytes from tomcat-net-02.mynet (192.168.0.3): icmp_seq=1 ttl=64 time=0.059 ms</span><br><span class="line">64 bytes from tomcat-net-02.mynet (192.168.0.3): icmp_seq=2 ttl=64 time=0.074 ms</span><br><span class="line">^C</span><br><span class="line">--- tomcat-net-02 ping statistics ---</span><br><span class="line">2 packets transmitted, 2 received, 0% packet loss, time 1000ms</span><br><span class="line">rtt min/avg/max/mdev = 0.059/0.066/0.074/0.011 ms</span><br><span class="line">[root@iz2zege5xssb2avm6if6l8z ~]#</span><br></pre></td></tr></tbody></table></figure>

<p>我们自定义的网络docker都已经帮我们维护好了对应的关系，推荐我们平时这样使用网络!</p>
<p>好处:</p>
<p>redis 不同的集群使用不同的网络，保证集群是安全和健康的<br>mysql不同的集群使用不同的网络，保证集群是安全和健康的</p>
<h2 id="网络连通"><a href="#网络连通" class="headerlink" title="网络连通"></a>网络连通</h2><p><img alt="image-20200623181330761" data-src="http://yhaq.top/group1/M00/00/00/rBGWVV7zeLqAEi43AACv0uHbHn4286.png" class="lazyload"></p>
<p>不同网络的容器连通</p>
<p><img alt="image-20200623181314259" data-src="http://yhaq.top/group1/M00/00/00/rBGWVV7zeLqAUClgAALrjXRAg-8869.png" class="lazyload"></p>
<p><img alt="image-20200623181739448" data-src="http://yhaq.top/group1/M00/00/00/rBGWVV7zeLqAZvHSAABW-Egdem0778.png" class="lazyload"></p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 测试打通mynet</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 启动两个tomcat</span></span><br><span class="line">[root@iz2zege5xssb2avm6if6l8z ~]# docker run -d -P --name tomcat01 tomcat </span><br><span class="line">7f3ac362d51b9a2d1d5360af669ca1c476121f34c9233eb433b15ba883b1977b</span><br><span class="line">[root@iz2zege5xssb2avm6if6l8z ~]# docker run -d -P --name tomcat02 tomcat </span><br><span class="line">256283054e304dfa27f2f0f7e10af739a3cbbf8cff5f3dd4f0dd3ad8a847d071</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 将tomcat01打通到mynet</span></span><br><span class="line">[root@iz2zege5xssb2avm6if6l8z ~]# docker network connect mynet tomcat01</span><br><span class="line">[root@iz2zege5xssb2avm6if6l8z ~]# docker inspect mynet</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 这是可以发现tomcat01 被添加到mynet中</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 一个容器两个ip地址</span></span><br></pre></td></tr></tbody></table></figure>

<p><img alt="image-20200623182054966" data-src="http://yhaq.top/group1/M00/00/00/rBGWVV7zeLqAHYR3AACGB7NRV1U602.png" class="lazyload"></p>
<figure class="highlight powershell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 再次ping tomcat-net-02</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">iz2zege5xssb2avm6if6l8z</span> ~]<span class="comment"># docker exec -it tomcat01 ping tomcat-net-02</span></span><br><span class="line">PING tomcat<span class="literal">-net</span><span class="literal">-02</span> (<span class="number">192.168</span>.<span class="number">0.3</span>) <span class="number">56</span>(<span class="number">84</span>) bytes of data.</span><br><span class="line"><span class="number">64</span> bytes from tomcat<span class="literal">-net</span><span class="literal">-02</span>.mynet (<span class="number">192.168</span>.<span class="number">0.3</span>): icmp_seq=<span class="number">1</span> ttl=<span class="number">64</span> time=<span class="number">0.091</span> ms</span><br><span class="line"><span class="number">64</span> bytes from tomcat<span class="literal">-net</span><span class="literal">-02</span>.mynet (<span class="number">192.168</span>.<span class="number">0.3</span>): icmp_seq=<span class="number">2</span> ttl=<span class="number">64</span> time=<span class="number">0.079</span> ms</span><br><span class="line">^C</span><br><span class="line">--- tomcat<span class="literal">-net</span><span class="literal">-02</span> ping statistics ---</span><br><span class="line"><span class="number">2</span> packets transmitted, <span class="number">2</span> received, <span class="number">0</span>% packet loss, time <span class="number">1000</span>ms</span><br><span class="line">rtt min/avg/max/mdev = <span class="number">0.079</span>/<span class="number">0.085</span>/<span class="number">0.091</span>/<span class="number">0.006</span> ms</span><br><span class="line">[<span class="type">root</span>@<span class="type">iz2zege5xssb2avm6if6l8z</span> ~]<span class="comment">#</span></span><br></pre></td></tr></tbody></table></figure>

<h2 id="实战部署一个redis集群"><a href="#实战部署一个redis集群" class="headerlink" title="实战部署一个redis集群"></a>实战部署一个redis集群</h2><p><img alt="image-20200623185615313" data-src="http://yhaq.top/group1/M00/00/00/rBGWVV7zeLqAUzoQAACzDCckWPo146.png" class="lazyload"></p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 创建一个redis集群的网络</span></span><br><span class="line">[root@iz2zege5xssb2avm6if6l8z DiyTomcat]# docker network create redis --subnet 172.38.0.0/16</span><br><span class="line">44c288906e1183fdebeefff7f1e998b41e2dcf19dec7139cb6f4bd59ed1a22f8</span><br><span class="line">[root@iz2zege5xssb2avm6if6l8z DiyTomcat]# docker network ls</span><br><span class="line">NETWORK ID          NAME                DRIVER              SCOPE</span><br><span class="line">f483d10c32be        bridge              bridge              local</span><br><span class="line">a3b709f8b13f        host                host                local</span><br><span class="line">337622e48719        mynet               bridge              local</span><br><span class="line">c79127d1fc8f        none                null                local</span><br><span class="line">44c288906e11        redis               bridge              local</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 使用shell脚本创建6个redis容器</span></span><br><span class="line"></span><br><span class="line">for port in $(seq 1 6); \</span><br><span class="line">do \</span><br><span class="line">mkdir -p /mydata/redis/node-${port}/conf</span><br><span class="line">touch /mydata/redis/node-${port}/conf/redis.conf</span><br><span class="line">cat << EOF >/mydata/redis/node-${port}/conf/redis.conf</span><br><span class="line">port 6379</span><br><span class="line">bind 0.0.0.0</span><br><span class="line">cluster-enabled yes</span><br><span class="line">cluster-config-file nodes.conf</span><br><span class="line">cluster-node-timeout 5000</span><br><span class="line">cluster-announce-ip 172.38.0.1${port}</span><br><span class="line">cluster-announce-port 6379</span><br><span class="line">cluster-announce-bus-port 16379</span><br><span class="line">appendonly yes</span><br><span class="line">EOF</span><br><span class="line">done</span><br><span class="line"></span><br><span class="line">docker run -p 6371:6379 -p 16371:16379 --name redis-1 \</span><br><span class="line">-v /mydata/redis/node-1/data:/data \</span><br><span class="line">-v /mydata/redis/node-1/conf/redis.conf:/etc/redis/redis.conf \</span><br><span class="line">-d --net redis --ip 172.38.0.11 redis redis-server /etc/redis/redis.conf; \</span><br><span class="line"></span><br><span class="line">docker run -p 6372:6379 -p 16372:16379 --name redis-2 \</span><br><span class="line">-v /mydata/redis/node-2/data:/data \</span><br><span class="line">-v /mydata/redis/node-2/conf/redis.conf:/etc/redis/redis.conf \</span><br><span class="line">-d --net redis --ip 172.38.0.12 redis redis-server /etc/redis/redis.conf</span><br><span class="line"></span><br><span class="line">docker run -p 6373:6379 -p 16373:16379 --name redis-3 \</span><br><span class="line">-v /mydata/redis/node-3/data:/data \</span><br><span class="line">-v /mydata/redis/node-3/conf/redis.conf:/etc/redis/redis.conf \</span><br><span class="line">-d --net redis --ip 172.38.0.13 redis redis-server /etc/redis/redis.conf</span><br><span class="line"></span><br><span class="line">docker run -p 6374:6379 -p 16374:16379 --name redis-4 \</span><br><span class="line">-v /mydata/redis/node-4/data:/data \</span><br><span class="line">-v /mydata/redis/node-4/conf/redis.conf:/etc/redis/redis.conf \</span><br><span class="line">-d --net redis --ip 172.38.0.14 redis redis-server /etc/redis/redis.conf</span><br><span class="line"></span><br><span class="line">docker run -p 6375:6379 -p 16375:16379 --name redis-5 \</span><br><span class="line">-v /mydata/redis/node-5/data:/data \</span><br><span class="line">-v /mydata/redis/node-5/conf/redis.conf:/etc/redis/redis.conf \</span><br><span class="line">-d --net redis --ip 172.38.0.15 redis redis-server /etc/redis/redis.conf</span><br><span class="line"></span><br><span class="line">docker run -p 6376:6379 -p 16376:16379 --name redis-6 \</span><br><span class="line">-v /mydata/redis/node-6/data:/data \</span><br><span class="line">-v /mydata/redis/node-6/conf/redis.conf:/etc/redis/redis.conf \</span><br><span class="line">-d --net redis --ip 172.38.0.16 redis redis-server /etc/redis/redis.conf</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 进入任意redis中</span></span><br><span class="line">docker exec -it redis-1 /bin/sh</span><br><span class="line"></span><br><span class="line">redis-cli --cluster create 172.38.0.11:6379 172.38.0.12:6379 172.38.0.13:6379 172.38.0.14:6379 172.38.0.15:6379 172.38.0.16:6379 --cluster-replicas 1</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> redis-cli --cluster create 172.38.0.11:6379 172.38.0.12:6379 172.38.0.13:6379 172.38.0.14:6379 172.38.0.15:6379 172.38.0.16:6379 --cluster-replicas 1</span></span><br><span class="line"><span class="meta">></span><span class="bash">>> Performing <span class="built_in">hash</span> slots allocation on 6 nodes...</span></span><br><span class="line">Master[0] -> Slots 0 - 5460</span><br><span class="line">Master[1] -> Slots 5461 - 10922</span><br><span class="line">Master[2] -> Slots 10923 - 16383</span><br><span class="line">Adding replica 172.38.0.15:6379 to 172.38.0.11:6379</span><br><span class="line">Adding replica 172.38.0.16:6379 to 172.38.0.12:6379</span><br><span class="line">Adding replica 172.38.0.14:6379 to 172.38.0.13:6379</span><br><span class="line">M: 79d7613a7c55e739c7fa421976897b6ca906d606 172.38.0.11:6379</span><br><span class="line">   slots:[0-5460] (5461 slots) master</span><br><span class="line">M: 2692ff38af4134f7d6a68ca80cc5e591fdc35609 172.38.0.12:6379</span><br><span class="line">   slots:[5461-10922] (5462 slots) master</span><br><span class="line">M: f3981ec5d2bb2e8f1295b1537e15cec1d52282f5 172.38.0.13:6379</span><br><span class="line">   slots:[10923-16383] (5461 slots) master</span><br><span class="line">S: ebbd06ec128e22bfb3c1cc9eec02f5f2c0d4231c 172.38.0.14:6379</span><br><span class="line">   replicates f3981ec5d2bb2e8f1295b1537e15cec1d52282f5</span><br><span class="line">S: 550c0efeb2fad409f9ed2e38379f945c12ceaf82 172.38.0.15:6379</span><br><span class="line">   replicates 79d7613a7c55e739c7fa421976897b6ca906d606</span><br><span class="line">S: 59403f0f5f17852a1dbeb15b44a5bec5d5c4991a 172.38.0.16:6379</span><br><span class="line">   replicates 2692ff38af4134f7d6a68ca80cc5e591fdc35609</span><br><span class="line">Can I set the above configuration? (type 'yes' to accept): yes</span><br><span class="line"><span class="meta">></span><span class="bash">>> Nodes configuration updated</span></span><br><span class="line"><span class="meta">></span><span class="bash">>> Assign a different config epoch to each node</span></span><br><span class="line"><span class="meta">></span><span class="bash">>> Sending CLUSTER MEET messages to join the cluster</span></span><br><span class="line">Waiting for the cluster to join</span><br><span class="line">..</span><br><span class="line"><span class="meta">></span><span class="bash">>> Performing Cluster Check (using node 172.38.0.11:6379)</span></span><br><span class="line">M: 79d7613a7c55e739c7fa421976897b6ca906d606 172.38.0.11:6379</span><br><span class="line">   slots:[0-5460] (5461 slots) master</span><br><span class="line">   1 additional replica(s)</span><br><span class="line">S: 550c0efeb2fad409f9ed2e38379f945c12ceaf82 172.38.0.15:6379</span><br><span class="line">   slots: (0 slots) slave</span><br><span class="line">   replicates 79d7613a7c55e739c7fa421976897b6ca906d606</span><br><span class="line">S: 59403f0f5f17852a1dbeb15b44a5bec5d5c4991a 172.38.0.16:6379</span><br><span class="line">   slots: (0 slots) slave</span><br><span class="line">   replicates 2692ff38af4134f7d6a68ca80cc5e591fdc35609</span><br><span class="line">M: f3981ec5d2bb2e8f1295b1537e15cec1d52282f5 172.38.0.13:6379</span><br><span class="line">   slots:[10923-16383] (5461 slots) master</span><br><span class="line">   1 additional replica(s)</span><br><span class="line">M: 2692ff38af4134f7d6a68ca80cc5e591fdc35609 172.38.0.12:6379</span><br><span class="line">   slots:[5461-10922] (5462 slots) master</span><br><span class="line">   1 additional replica(s)</span><br><span class="line">S: ebbd06ec128e22bfb3c1cc9eec02f5f2c0d4231c 172.38.0.14:6379</span><br><span class="line">   slots: (0 slots) slave</span><br><span class="line">   replicates f3981ec5d2bb2e8f1295b1537e15cec1d52282f5</span><br><span class="line">[OK] All nodes agree about slots configuration.</span><br><span class="line"><span class="meta">></span><span class="bash">>> Check <span class="keyword">for</span> open slots...</span></span><br><span class="line"><span class="meta">></span><span class="bash">>> Check slots coverage...</span></span><br><span class="line">[OK] All 16384 slots covered.</span><br></pre></td></tr></tbody></table></figure>

<p><img alt="image-20200623203120245" data-src="http://yhaq.top/group1/M00/00/00/rBGWVV7zeLqAfoeiAABTBWOCM58195.png" class="lazyload"></p>
<p><img alt="image-20200623203140305" data-src="http://yhaq.top/group1/M00/00/01/rBGWVV7zeLqAf2xjAAB45HGrn7k504.png" class="lazyload"></p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379> set a b</span><br><span class="line"><span class="meta">-></span><span class="bash"> Redirected to slot [15495] located at 172.38.0.13:6379</span></span><br><span class="line">OK</span><br><span class="line">172.38.0.13:6379> get a</span><br><span class="line">"b"</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 这时停止第3个节点</span></span><br><span class="line">127.0.0.1:6379> get a</span><br><span class="line"><span class="meta">-></span><span class="bash"> Redirected to slot [15495] located at 172.38.0.14:6379</span></span><br><span class="line">"b"</span><br></pre></td></tr></tbody></table></figure>

<p><img alt="image-20200623203709021" data-src="http://yhaq.top/group1/M00/00/01/rBGWVV7zeLqATIMAAAB797JbTHI860.png" class="lazyload"></p>
<h1 id="Spring-Boot-打包发布docker"><a href="#Spring-Boot-打包发布docker" class="headerlink" title="Spring Boot 打包发布docker"></a>Spring Boot 打包发布docker</h1><p>1、构建springboot项目</p>
<p>2、打包应用</p>
<p>3、编写dockerfile</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">FROM java:8</span><br><span class="line"></span><br><span class="line">COPY *.jar /app.jar</span><br><span class="line"></span><br><span class="line">CMD ["--server.port=8080"]</span><br><span class="line"></span><br><span class="line">EXPOSE 8080</span><br><span class="line"></span><br><span class="line">ENTRYPOINT ["java","-jar","/app.jar"]</span><br></pre></td></tr></tbody></table></figure>

<p>4、docker build</p>
<p>5、docker run</p>
</body></html></div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">Nigtunt</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://nigtunt.github.io/2020/06/26/docker%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E5%85%A5%E9%97%A8/">https://nigtunt.github.io/2020/06/26/docker%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E5%85%A5%E9%97%A8/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" rel="noopener">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://nigtunt.github.io">Nigtunt</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/docker/">docker    </a></div><div class="post_share"><div class="social-share" data-image="https://timgsa.baidu.com/timg?image&amp;quality=80&amp;size=b9999_10000&amp;sec=1593166873350&amp;di=8ec88b6a272f42e99b088baa56395b63&amp;imgtype=0&amp;src=http%3A%2F%2Fimg4.imgtn.bdimg.com%2Fit%2Fu%3D3899586244%2C3729560110%26fm%3D214%26gp%3D0.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js@1.0.16/dist/css/share.min.css"><script src="https://cdn.jsdelivr.net/npm/social-share.js@1.0.16/dist/js/social-share.min.js"></script></div></div><div class="post-reward"><a class="reward-button"><i class="fa fa-qrcode"></i> 打赏<div class="reward-main"><ul class="reward-all"><li class="reward-item"><img class="lazyload post-qr-code__img" src="/img/wechat.jpg"><div class="post-qr-code__desc">微信</div></li><li class="reward-item"><img class="lazyload post-qr-code__img" src="/img/alipay.jpg"><div class="post-qr-code__desc">支付寶</div></li></ul></div></a></div><nav class="pagination_post" id="pagination"><div class="prev-post pull_left"><a href="/2020/06/26/MybatisPlus%E4%BD%BF%E7%94%A8%E7%AE%80%E4%BB%8B/"><img class="prev_cover lazyload" data-src="http://yhaq.top/group1/M00/00/01/rBGWVV711OiAL6z1AALarnNfQXk297.png" onerror="onerror=null;src='/img/404.jpg'"><div class="label">上一篇</div><div class="prev_info"><span>MybatisPlus使用简介</span></div></a></div><div class="next-post pull_right"><a href="/2020/06/26/%E4%BD%BF%E7%94%A8redis%E5%AD%98%E5%9C%A8%E7%9A%84%E9%97%AE%E9%A2%98/"><img class="next_cover lazyload" data-src="https://ss2.bdstatic.com/70cFvnSh_Q1YnxGkpoWK1HF6hhy/it/u=1303138373,851257239&amp;fm=26&amp;gp=0.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="label">下一篇</div><div class="next_info"><span>使用redis存在的问题</span></div></a></div></nav><div class="relatedPosts"><div class="relatedPosts_headline"><i class="fa fa-fw fa-thumbs-up" aria-hidden="true"></i><span> 相关推荐</span></div><div class="relatedPosts_list"><div class="relatedPosts_item"><a href="/2020/07/28/docker-compose-and-docker-swarm/" title="docker compose and docker swarm"><img class="relatedPosts_cover lazyload"data-src="https://ss1.bdstatic.com/70cFuXSh_Q1YnxGkpoWK1HF6hhy/it/u=1727875035,1058014352&fm=26&gp=0.jpg"><div class="relatedPosts_title">docker compose and docker swarm</div></a></div></div><div class="clear_both"></div></div></div></div><footer id="footer" style="background-image: url(https://timgsa.baidu.com/timg?image&amp;quality=80&amp;size=b9999_10000&amp;sec=1593166873350&amp;di=8ec88b6a272f42e99b088baa56395b63&amp;imgtype=0&amp;src=http%3A%2F%2Fimg4.imgtn.bdimg.com%2Fit%2Fu%3D3899586244%2C3729560110%26fm%3D214%26gp%3D0.jpg)"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2023 By Nigtunt</div><div class="framework-info"><span>驱动 </span><a href="http://hexo.io" target="_blank" rel="noopener"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 </span><a href="https://github.com/jerryc127/hexo-theme-butterfly" target="_blank" rel="noopener"><span>Butterfly</span></a></div><div class="footer_custom_text">Hi, welcome to my <a href="https://jerryc.me/" target="_blank" rel="noopener">blog</a>!</div></div></footer></div><section class="rightside" id="rightside"><div id="rightside-config-hide"><i class="fa fa-book" id="readmode" title="阅读模式"></i><i class="fa fa-plus" id="font_plus" title="放大字体"></i><i class="fa fa-minus" id="font_minus" title="缩小字体"></i><a class="translate_chn_to_cht" id="translateLink" href="javascript:translatePage();" title="简繁转换" target="_self">繁</a><i class="darkmode fa fa-moon-o" id="darkmode" title="夜间模式"></i></div><div id="rightside-config-show"><div id="rightside_config" title="设置"><i class="fa fa-cog" aria-hidden="true"></i></div><i class="fa fa-list-ul close" id="mobile-toc-button" title="目录" aria-hidden="true"></i><i class="fa fa-arrow-up" id="go-up" title="回到顶部" aria-hidden="true"></i></div></section><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script async src="/js/search/local-search.js"></script><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="/js/third-party/fireworks.js"></script><script id="ribbon_piao" mobile="false" src="/js/third-party/piao.js"></script><script src="/js/baidupush.js"> </script><script src="/js/tw_cn.js"></script><script>translateInitilization()
</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@3/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/lazysizes@latest/lazysizes.min.js" async=""></script><div class="search-dialog" id="local-search"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章"></div></div></div><hr><div id="local-search-results"><div id="local-hits"></div><div id="local-stats"><div class="local-search-stats__hr" id="hr"><span>由</span> <a href="https://github.com/wzpan/hexo-generator-search" target="_blank" rel="noopener" style="color:#49B1F5;">hexo-generator-search</a>
 <span>提供支持</span></div></div></div><span class="search-close-button"><i class="fa fa-times"></i></span></div><div class="search-mask"></div></body></html>